(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,o=0;o<t.length;o++)if(t[o].identifier===e){n=o;break}return n}function o(e,o){for(var a={},s=[],r=0;r<e.length;r++){var l=e[r],c=o.base?l[0]+o.base:l[0],d=a[c]||0,p="".concat(c," ").concat(d);a[c]=d+1;var h=n(p),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==h)t[h].references++,t[h].updater(u);else{var m=i(u,o);o.byIndex=r,t.splice(r,0,{identifier:p,updater:m,references:1})}s.push(p)}return s}function i(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,i){var a=o(e=e||[],i=i||{});return function(e){e=e||[];for(var s=0;s<a.length;s++){var r=n(a[s]);t[r].references--}for(var l=o(e,i),c=0;c<a.length;c++){var d=n(a[c]);0===t[d].references&&(t[d].updater(),t.splice(d,1))}a=l}}},98:e=>{e.exports='data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 51 48"><path fill="%23FFD700" d="M25.5 0l6.5 17h18l-14 11 5 17-15.5-10-15.5 10 5-17-14-11h18z"/></svg>'},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",o=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),o&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),o&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,o,i,a){"string"==typeof e&&(e=[[null,e,void 0]]);var s={};if(o)for(var r=0;r<this.length;r++){var l=this[r][0];null!=l&&(s[l]=!0)}for(var c=0;c<e.length;c++){var d=[].concat(e[c]);o&&s[d[0]]||(void 0!==a&&(void 0===d[5]||(d[1]="@layer".concat(d[5].length>0?" ".concat(d[5]):""," {").concat(d[1],"}")),d[5]=a),n&&(d[2]?(d[1]="@media ".concat(d[2]," {").concat(d[1],"}"),d[2]=n):d[2]=n),i&&(d[4]?(d[1]="@supports (".concat(d[4],") {").concat(d[1],"}"),d[4]=i):d[4]="".concat(i)),t.push(d))}},t}},417:e=>{e.exports=function(e,t){return t||(t={}),e?(e=String(e.__esModule?e.default:e),/^['"].*['"]$/.test(e)&&(e=e.slice(1,-1)),t.hash&&(e+=t.hash),/["'() \t\n]|(%20)/.test(e)||t.needQuotes?'"'.concat(e.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):e):e}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},552:(e,t,n)=>{n.d(t,{A:()=>h});var o=n(601),i=n.n(o),a=n(314),s=n.n(a),r=n(417),l=n.n(r),c=new URL(n(98),n.b),d=s()(i()),p=l()(c);d.push([e.id,`* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: Arial, sans-serif;\n    line-height: 1.6;\n    background-color: #f4f4f4;\n    color: #333;\n    padding: 20px;\n    font-size: 18px;\n    width: 100%;\n    max-width: 100%;\n    box-sizing: border-box;\n}\n\n.container {\n    width: 95%;\n    max-width: 100%;\n    margin: 0 auto;\n    padding: 30px;\n    background-color: white;\n    border-radius: 10px;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n    box-sizing: border-box;\n}\n\nh1 {\n    text-align: center;\n    margin-bottom: 30px;\n    color: #2c3e50;\n    font-size: 36px;\n}\n\n#game-container {\n    margin-bottom: 30px;\n}\n\n#sheet-music {\n    height: 225px;\n    background-color: #f9f9f9;\n    border: 1px solid #ddd;\n    margin-bottom: 30px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n#note-options {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 20px;\n    min-height: 300px;\n    position: relative;\n}\n\n.note-button {\n    padding: 15px 30px;\n    background-color: #3498db;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 22px;\n    transition: background-color 0.3s;\n}\n\n.note-button:hover {\n    background-color: #2980b9;\n}\n\n/* Piano Keyboard Styles */\n.toggle-buttons {\n    display: flex;\n    justify-content: center;\n    gap: 10px;\n    margin-bottom: 15px;\n}\n\n.toggle-button {\n    padding: 8px 15px;\n    background-color: #2c3e50;\n    color: white;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 16px;\n}\n\n.toggle-button:hover {\n    background-color: #1a2530;\n}\n\n.piano-keyboard {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    border: 1px solid #ccc;\n    border-radius: 5px;\n    padding: 20px 10px 25px;\n    background-color: #e0e0e0;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n    width: 100%;\n    margin-bottom: 20px;\n    position: relative;\n    overflow-x: visible;\n}\n\n/* Styles for dual keyboards */\n.keyboards-container {\n    display: flex;\n    flex-direction: column;\n    width: 100%;\n    gap: 20px;\n}\n\n.keyboard-label {\n    font-size: 18px;\n    font-weight: bold;\n    margin-bottom: 10px;\n    color: #2c3e50;\n    text-align: center;\n}\n\n.piano-keyboard[data-clef="treble"] {\n    background-color: #e1f5fe; /* Light blue for treble clef */\n}\n\n.piano-keyboard[data-clef="bass"] {\n    background-color: #d4e6f1; /* Slightly different blue for bass clef */\n}\n\n.keyboard-keys {\n    display: flex;\n    flex-direction: row;\n    justify-content: center;\n    width: auto;\n    overflow-x: auto;\n    position: relative;\n    min-height: 300px;\n    padding-bottom: 15px;\n    margin-bottom: 0;\n    -webkit-overflow-scrolling: touch;\n    max-width: 100%;\n}\n\n.octave {\n    display: flex;\n    position: relative;\n    height: 270px;\n    flex-shrink: 0;\n}\n\n.third-octave {\n    width: auto;\n}\n\n.piano-key {\n    position: relative;\n    cursor: pointer;\n    display: flex;\n    justify-content: center;\n    align-items: flex-end;\n    padding-bottom: 15px;\n    transition: all 0.2s;\n}\n\n.white-key {\n    width: 45px;\n    min-width: 40px;\n    height: 270px;\n    background-color: white;\n    border: 1px solid #999;\n    z-index: 1;\n}\n\n.black-key {\n    width: 30px;\n    min-width: 25px;\n    height: 162px;\n    background-color: black;\n    border: 1px solid #666;\n    z-index: 2;\n    position: absolute;\n    top: 0;\n    color: white;\n    padding-bottom: 7px;\n}\n\n.piano-key.selectable {\n    cursor: pointer;\n}\n\n.white-key.selectable:hover {\n    background-color: #e3f2fd;\n}\n\n.black-key.selectable:hover {\n    background-color: #333;\n}\n\n.piano-key.disabled {\n    opacity: 0.25;\n    cursor: default;\n}\n\n.note-name {\n    font-size: 18px;\n    font-weight: bold;\n}\n\n.white-key .note-name {\n    color: #333;\n}\n\n.black-key .note-name {\n    color: white;\n}\n\n/* Middle C indicator */\n.piano-key.middle-c::after {\n    content: "Middle C";\n    position: absolute;\n    bottom: -25px;\n    left: 50%;\n    transform: translateX(-50%);\n    font-size: 12px;\n    color: #e74c3c;\n    font-weight: bold;\n    white-space: nowrap;\n    width: 100%;\n    text-align: center;\n    pointer-events: none;\n    z-index: 10;\n}\n\n.piano-key.middle-c {\n    border-bottom: 4px solid #e74c3c;\n}\n\n/* Two-column layout for feedback and stats */\n#feedback-stats-container {\n    display: flex;\n    margin-top: 20px;\n    margin-bottom: 30px;\n    gap: 20px;\n}\n\n#feedback-column {\n    flex: 1;\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    position: relative;\n    min-height: 120px;\n}\n\n#stats-column {\n    flex: 1;\n    display: flex;\n    justify-content: center;\n}\n\n/* Top bar with profile and stats */\n#game-top-bar {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 20px;\n    background-color: #e8f4f8;\n    padding: 12px 15px;\n    border-radius: 8px;\n    border: 1px solid #b8e0ed;\n    align-items: center;\n}\n\n#profile-section, #level-section {\n    display: flex;\n    align-items: center;\n    gap: 15px;\n}\n\n#profile-name-display, #level-name-display {\n    font-size: 16px;\n    font-weight: bold;\n    color: #2c3e50;\n    padding: 8px 12px;\n    background-color: white;\n    border-radius: 6px;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n#profile-name, #level-name {\n    color: #3498db;\n    font-style: italic;\n}\n\n.top-stats {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    background-color: white;\n    border-radius: 6px;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n}\n\n.top-goal {\n    display: flex;\n    align-items: center;\n    padding: 8px 12px;\n    background-color: white;\n    border-radius: 6px;\n    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);\n    gap: 8px;\n}\n\n.stats-icon {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 30px;\n    height: 30px;\n    background-color: #e8f4f8;\n    border-radius: 50%;\n    margin-right: 10px;\n    color: #3498db;\n    font-size: 14px;\n}\n\n.stats-info {\n    display: flex;\n    align-items: center;\n}\n\n.stats-label {\n    font-size: 14px;\n    color: #7f8c8d;\n    margin-right: 6px;\n}\n\n.stats-value {\n    font-size: 16px;\n    font-weight: bold;\n    color: #2c3e50;\n}\n\n.stats-unit {\n    font-size: 12px;\n    color: #7f8c8d;\n    margin-left: 3px;\n}\n\n.goal-title {\n    font-weight: bold;\n    font-size: 14px;\n    color: #3498db;\n}\n\n.goal-details {\n    font-size: 14px;\n}\n\n#streak-required, #speed-required {\n    font-weight: bold;\n    color: #e74c3c;\n}\n\n/* Full-width feedback area */\n#feedback-container {\n    position: relative;\n    width: 100%;\n    margin-top: 20px;\n    margin-bottom: 30px;\n    min-height: 100px;\n    display: flex;\n    justify-content: center;\n}\n\n/* Enhanced feedback styles with animation */\n#feedback {\n    text-align: center;\n    font-weight: bold;\n    font-size: 28px;\n    margin-bottom: 10px;\n    padding: 15px;\n    border-radius: 10px;\n    width: 100%;\n    max-width: 800px;\n    transition: all 0.3s ease;\n    opacity: 0;\n    transform: translateY(20px);\n}\n\n#feedback.active {\n    opacity: 1;\n    transform: translateY(0);\n}\n\n.celebration-container {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    pointer-events: none;\n    overflow: hidden;\n    z-index: 10;\n}\n\n@keyframes confetti-fall {\n    0% {\n        transform: translateY(-100%) rotate(0deg);\n        opacity: 1;\n    }\n    100% {\n        transform: translateY(100vh) rotate(720deg);\n        opacity: 0;\n    }\n}\n\n@keyframes star-appear {\n    0% {\n        transform: scale(0) rotate(0deg);\n        opacity: 0;\n    }\n    50% {\n        transform: scale(1.2) rotate(180deg);\n        opacity: 1;\n    }\n    100% {\n        transform: scale(1) rotate(360deg);\n        opacity: 0;\n    }\n}\n\n.confetti-piece {\n    position: absolute;\n    width: 10px;\n    height: 20px;\n    background-color: #f39c12;\n    top: -20px;\n    opacity: 0;\n    animation: confetti-fall 2.5s ease-out forwards;\n}\n\n/* Level-up confetti - larger and more prominent */\n.level-up-confetti {\n    width: 15px !important;\n    height: 30px !important;\n    animation-duration: 3.5s !important;\n    z-index: 1000;\n}\n\n/* Special confetti shapes for level up */\n.special-confetti {\n    position: absolute;\n    width: 40px;\n    height: 40px;\n    top: -40px;\n    background-image: url(${p});\n    background-size: contain;\n    opacity: 0;\n    z-index: 1000;\n    animation: special-confetti-fall 3s ease-out forwards;\n}\n\n@keyframes special-confetti-fall {\n    0% {\n        transform: translateY(-50px) rotate(0deg) scale(0.5);\n        opacity: 0;\n    }\n    10% {\n        opacity: 1;\n    }\n    100% {\n        transform: translateY(100vh) rotate(720deg) scale(1.5);\n        opacity: 0;\n    }\n}\n\n/* Level up overlay */\n.level-up-overlay {\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.8);\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    z-index: 9999;\n    animation: fade-in 0.5s ease-out forwards;\n}\n\n.level-up-overlay.fade-out {\n    animation: fade-out 0.5s ease-in forwards;\n}\n\n@keyframes fade-in {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n@keyframes fade-out {\n    from { opacity: 1; }\n    to { opacity: 0; }\n}\n\n.level-up-container {\n    background: linear-gradient(135deg, #3498db, #9b59b6);\n    border-radius: 20px;\n    padding: 40px;\n    text-align: center;\n    box-shadow: 0 0 30px rgba(52, 152, 219, 0.7);\n    max-width: 90%;\n    animation: pop-in 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;\n    position: relative;\n    overflow: hidden;\n}\n\n@keyframes pop-in {\n    0% {\n        transform: scale(0.5);\n        opacity: 0;\n    }\n    80% {\n        transform: scale(1.1);\n    }\n    100% {\n        transform: scale(1);\n        opacity: 1;\n    }\n}\n\n.level-up-message {\n    color: white;\n    text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\n}\n\n.level-up-message h1 {\n    font-size: 60px;\n    margin-bottom: 20px;\n    color: #fff;\n    animation: pulse 1.5s infinite;\n}\n\n.level-up-message h2 {\n    font-size: 40px;\n    margin-bottom: 15px;\n    color: #fff;\n}\n\n.level-up-message h3 {\n    font-size: 30px;\n    color: #f1c40f;\n}\n\n@keyframes pulse {\n    0% {\n        transform: scale(1);\n        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\n    }\n    50% {\n        transform: scale(1.05);\n        text-shadow: 0 5px 15px rgba(255, 255, 255, 0.7);\n    }\n    100% {\n        transform: scale(1);\n        text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);\n    }\n}\n\n/* Star decoration for level up */\n.level-up-stars {\n    position: absolute;\n    width: 100%;\n    height: 40px;\n    top: 10px;\n    left: 0;\n    display: flex;\n    justify-content: center;\n    gap: 30px;\n}\n\n.level-up-star {\n    width: 40px;\n    height: 40px;\n    background-image: url(${p});\n    background-size: contain;\n    animation: star-spin 2s infinite linear;\n}\n\n@keyframes star-spin {\n    from {\n        transform: rotate(0deg) scale(1);\n    }\n    50% {\n        transform: rotate(180deg) scale(1.2);\n    }\n    to {\n        transform: rotate(360deg) scale(1);\n    }\n}\n\n.star {\n    position: absolute;\n    width: 30px;\n    height: 30px;\n    background-image: url(${p});\n    background-size: contain;\n    opacity: 0;\n    animation: star-appear 2s ease-out forwards;\n}\n\n/* Improved game stats styles */\n#game-stats {\n    width: 100%;\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n    padding: 15px;\n    background-color: #f8f9fa;\n    border-radius: 10px;\n    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);\n}\n\n.stats-card {\n    display: flex;\n    align-items: center;\n    padding: 12px 15px;\n    background-color: white;\n    border-radius: 8px;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n    transition: transform 0.2s ease;\n}\n\n.stats-card:hover {\n    transform: translateY(-2px);\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);\n}\n\n.level-goal-card {\n    background-color: #e8f4f8;\n    border-radius: 8px;\n    padding: 12px 15px;\n    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);\n}\n\n/* Progress indicators for stats */\n.goal-met {\n    color: #2ecc71 !important;\n}\n\n.progress {\n    color: #f39c12 !important;\n}\n\n#score {\n    text-align: center;\n    font-size: 24px;\n    margin-bottom: 30px;\n}\n\n#controls {\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n}\n\nbutton {\n    padding: 15px 30px;\n    background-color: #2c3e50;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 22px;\n    transition: background-color 0.3s;\n}\n\nbutton:hover {\n    background-color: #1a2530;\n}\n\n/* Stats Popup Styles */\n.popup {\n    display: none;\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.7);\n    z-index: 1000;\n    overflow: auto;\n}\n\n.popup-content {\n    position: relative;\n    background-color: white;\n    width: 80%;\n    max-width: 800px;\n    margin: 50px auto;\n    padding: 30px;\n    border-radius: 10px;\n    box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);\n    max-height: 80vh;\n    overflow-y: auto;\n}\n\n.close-button {\n    position: absolute;\n    top: 15px;\n    right: 20px;\n    font-size: 30px;\n    font-weight: bold;\n    color: #666;\n    cursor: pointer;\n    transition: color 0.3s;\n}\n\n.close-button:hover {\n    color: #333;\n}\n\n.stats-section {\n    margin-bottom: 30px;\n}\n\n.stats-section h3 {\n    margin-bottom: 15px;\n    color: #2c3e50;\n    border-bottom: 1px solid #eee;\n    padding-bottom: 8px;\n}\n\n.stats-list {\n    font-size: 16px;\n    line-height: 1.6;\n}\n\n.note-group {\n    margin: 10px 0;\n    padding: 10px;\n    background-color: #f9f9f9;\n    border-radius: 5px;\n    border-left: 4px solid #3498db;\n}\n\n.level-item {\n    margin: 15px 0;\n    padding: 15px;\n    background-color: #f9f9f9;\n    border-radius: 5px;\n    border-left: 4px solid #2c3e50;\n}\n\n.level-title {\n    font-weight: bold;\n    font-size: 18px;\n    margin-bottom: 8px;\n    color: #2c3e50;\n}\n\n.level-description {\n    color: #666;\n    margin-bottom: 10px;\n}\n\n.level-notes {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 8px;\n}\n\n.note-tag {\n    display: inline-block;\n    padding: 4px 8px;\n    background-color: #3498db;\n    color: white;\n    border-radius: 4px;\n    font-size: 14px;\n}\n\n.note-tag.new {\n    background-color: #e74c3c;\n}\n\n/* Level selection styles */\n.level-selection {\n    display: flex;\n    flex-wrap: wrap;\n    gap: 10px;\n    margin-bottom: 15px;\n}\n\n.level-button {\n    padding: 8px 15px;\n    background-color: #3498db;\n    color: white;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 16px;\n    transition: background-color 0.3s;\n}\n\n.level-button:hover {\n    background-color: #2980b9;\n}\n\n.level-button.current {\n    background-color: #e74c3c;\n}\n\n.settings-controls {\n    display: flex;\n    flex-direction: column;\n    gap: 15px;\n}\n\n/* Cartoon character popup */\n.cartoon-character-popup {\n    position: fixed;\n    top: 20px;\n    right: 20px;\n    transform: scale(0.9);\n    background-color: white;\n    padding: 15px;\n    border-radius: 15px;\n    box-shadow: 0 5px 25px rgba(0, 0, 0, 0.3);\n    z-index: 1000;\n    text-align: left;\n    opacity: 0;\n    transition: all 0.3s ease;\n    max-width: 320px;\n    border: 4px solid #3498db;\n    pointer-events: none;\n    display: flex;\n    align-items: center;\n}\n\n.cartoon-character-popup.visible {\n    opacity: 1;\n    transform: scale(1);\n}\n\n.cartoon-character-popup .character-avatar {\n    width: 70px;\n    height: 70px;\n    margin-right: 15px;\n    flex-shrink: 0;\n}\n\n.cartoon-character-popup .character-avatar img {\n    width: 100%;\n    height: 100%;\n    object-fit: contain;\n    border: 2px solid #3498db;\n}\n\n.cartoon-character-popup .character-content {\n    flex: 1;\n}\n\n.cartoon-character-popup h3 {\n    font-size: 18px;\n    margin-bottom: 8px;\n    color: #2c3e50;\n}\n\n.cartoon-character-popup p {\n    font-size: 16px;\n    color: #34495e;\n    font-weight: bold;\n    margin: 0;\n}\n\n/* Show the popup when it has the 'active' class */\n.popup.active {\n    display: block;\n}\n\n/* Profile Display */\n#profile-info {\n    display: flex;\n    justify-content: space-between;\n    margin-bottom: 20px;\n    background-color: #e8f4f8;\n    padding: 10px 15px;\n    border-radius: 6px;\n    border: 1px solid #b8e0ed;\n}\n\n#profile-name-display, #level-name-display {\n    font-size: 16px;\n    font-weight: bold;\n    color: #2c3e50;\n}\n\n#profile-name, #level-name {\n    color: #3498db;\n    font-style: italic;\n}\n\n/* Profiles List */\n.profiles-list {\n    margin-bottom: 15px;\n    max-height: 200px;\n    overflow-y: auto;\n    border: 1px solid #ddd;\n    border-radius: 5px;\n    padding: 5px;\n}\n\n.profile-item {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 10px;\n    border-bottom: 1px solid #eee;\n    transition: background-color 0.2s;\n    cursor: pointer;\n    flex-wrap: wrap;\n}\n\n.profile-item:last-child {\n    border-bottom: none;\n}\n\n.profile-item:hover {\n    background-color: #f5f9fc;\n}\n\n.profile-item.active {\n    background-color: #e1f0fa;\n    font-weight: bold;\n}\n\n.profile-name {\n    flex-grow: 1;\n}\n\n/* Profile actions styles */\n.profile-actions {\n    margin-top: 10px;\n}\n\n.profile-add {\n    display: flex;\n    gap: 10px;\n}\n\n#new-profile-name {\n    flex-grow: 1;\n    padding: 8px;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    font-size: 16px;\n}\n\n/* Inline profile editing styles */\n.profile-edit-form-inline {\n    width: 100%;\n    margin-top: 10px;\n    display: none;\n    background-color: #f9f9f9;\n    padding: 10px;\n    border-radius: 4px;\n    border: 1px solid #ddd;\n}\n\n.profile-item.editing .profile-edit-form-inline {\n    display: flex;\n    flex-direction: column;\n    gap: 10px;\n}\n\n.profile-edit-actions {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 8px;\n}\n\n.profile-edit-button {\n    background-color: #3498db;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    padding: 4px 8px;\n    cursor: pointer;\n    font-size: 14px;\n}\n\n.profile-edit-button:hover {\n    background-color: #2980b9;\n}\n\n#add-profile-button {\n    background-color: #2ecc71;\n    color: white;\n    border: none;\n    border-radius: 4px;\n    padding: 8px 15px;\n    cursor: pointer;\n}\n\n#add-profile-button:hover {\n    background-color: #27ae60;\n}\n\n.edit-profile-input {\n    flex-grow: 1;\n    padding: 8px;\n    border: 1px solid #ccc;\n    border-radius: 4px;\n    font-size: 16px;\n}\n\n.save-profile-button, .delete-profile-button, .cancel-edit-button {\n    padding: 8px 15px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 16px;\n}\n\n.save-profile-button {\n    background-color: #2ecc71;\n    color: white;\n}\n\n.save-profile-button:hover {\n    background-color: #27ae60;\n}\n\n.cancel-edit-button {\n    background-color: #7f8c8d;\n    color: white;\n}\n\n.cancel-edit-button:hover {\n    background-color: #6b7a7c;\n}\n\n.delete-profile-button {\n    background-color: #e74c3c;\n    color: white;\n}\n\n.delete-profile-button:hover {\n    background-color: #c0392b;\n}\n\n.danger {\n    background-color: #e74c3c !important;\n    color: white !important;\n}\n\n.danger:hover {\n    background-color: #c0392b !important;\n}\n\n/* Modal */\n.modal {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    overflow: auto;\n    background-color: rgba(0, 0, 0, 0.6);\n}\n\n.modal.active {\n    display: block;\n}\n\n.modal-content {\n    background-color: #fefefe;\n    margin: 15% auto;\n    padding: 20px;\n    border-radius: 8px;\n    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);\n    width: 80%;\n    max-width: 400px;\n}\n\n.modal-close-button {\n    color: #aaa;\n    float: right;\n    font-size: 28px;\n    font-weight: bold;\n    cursor: pointer;\n}\n\n.modal-close-button:hover {\n    color: black;\n}\n\n.profile-edit-form {\n    margin-top: 20px;\n}\n\n.profile-edit-actions {\n    display: flex;\n    justify-content: space-between;\n    margin-top: 15px;\n}\n\n#save-profile-button, #delete-profile-button {\n    padding: 8px 15px;\n    border: none;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 16px;\n}\n\n#save-profile-button {\n    background-color: #2ecc71;\n    color: white;\n}\n\n#save-profile-button:hover {\n    background-color: #27ae60;\n}\n\n#delete-profile-button {\n    background-color: #e74c3c;\n    color: white;\n}\n\n#delete-profile-button:hover {\n    background-color: #c0392b;\n}\n\n.icon-button {\n    width: 50px;\n    height: 50px;\n    border-radius: 50%;\n    padding: 0;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n    font-size: 22px;\n}\n\n.icon-button:hover {\n    background-color: #34495e;\n}\n\n/* Add back styles for correct/incorrect feedback */\n.correct {\n    color: white;\n    background-color: #2ecc71;\n    box-shadow: 0 4px 8px rgba(46, 204, 113, 0.3);\n}\n\n.incorrect {\n    color: white;\n    background-color: #e74c3c;\n    box-shadow: 0 4px 8px rgba(231, 76, 60, 0.3);\n}\n\n/* Adjust the keyboard size to be more responsive */\n@media (min-width: 768px) {\n    .white-key {\n        width: 65px;\n    }\n    \n    .black-key {\n        width: 39px;\n    }\n}\n\n@media (min-width: 1200px) {\n    .white-key {\n        width: 75px;\n    }\n    \n    .black-key {\n        width: 45px;\n    }\n}\n\n@media (min-width: 1600px) {\n    .white-key {\n        width: 95px;\n    }\n    \n    .black-key {\n        width: 57px;\n    }\n}\n\n/* Green flash animation for streak display */\n@keyframes flash-green {\n    0% { box-shadow: 0 0 0 0px rgba(46, 204, 113, 0); }\n    50% { box-shadow: 0 0 20px 10px rgba(46, 204, 113, 0.7); background-color: rgba(46, 204, 113, 0.3); }\n    100% { box-shadow: 0 0 0 0px rgba(46, 204, 113, 0); }\n}\n\n.flash-green {\n    animation: flash-green 0.6s ease-out;\n}\n\n/* Error modal styles */\n.error-modal {\n    display: none;\n    position: fixed;\n    z-index: 1000;\n    left: 0;\n    top: 0;\n    width: 100%;\n    height: 100%;\n    background-color: rgba(0, 0, 0, 0.5);\n}\n\n.error-modal.active {\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n.error-modal-content {\n    background-color: white;\n    padding: 25px;\n    border-radius: 10px;\n    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);\n    width: 90%;\n    max-width: 450px;\n    text-align: center;\n    position: relative;\n    animation: modal-fade-in 0.3s ease-out;\n}\n\n@keyframes modal-fade-in {\n    0% { opacity: 0; transform: translateY(-20px); }\n    100% { opacity: 1; transform: translateY(0); }\n}\n\n.error-message {\n    font-size: 22px;\n    margin: 20px 0;\n    line-height: 1.4;\n    color: #333;\n}\n\n.error-modal-close {\n    position: absolute;\n    top: 10px;\n    right: 15px;\n    cursor: pointer;\n    font-size: 24px;\n    color: #999;\n    transition: color 0.2s;\n}\n\n.error-modal-close:hover {\n    color: #333;\n}\n\n.error-modal-button {\n    padding: 10px 20px;\n    background-color: #3498db;\n    color: white;\n    border: none;\n    border-radius: 5px;\n    cursor: pointer;\n    font-size: 18px;\n    transition: background-color 0.2s;\n}\n\n.error-modal-button:hover {\n    background-color: #2980b9;\n} `,""]);const h=d},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var o=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!o)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");o.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var o="";n.supports&&(o+="@supports (".concat(n.supports,") {")),n.media&&(o+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(o+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),o+=n.css,i&&(o+="}"),n.media&&(o+="}"),n.supports&&(o+="}");var a=n.sourceMap;a&&"undefined"!=typeof btoa&&(o+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(a))))," */")),t.styleTagTransform(o,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(o){var i=t[o];if(void 0!==i)return i.exports;var a=t[o]={id:o,exports:{}};return e[o](a,a.exports,n),a.exports}n.m=e,n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var o in t)n.o(t,o)&&!n.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.b=document.baseURI||self.location.href,n.nc=void 0;class o{static isLedgerLineNote(e){return e.position<=0||e.position>5}static isBelowStaff(e){return e.position<=0}static isAboveStaff(e){return e.position>5}static getNoteLabel(e){let t=e.name;if(e.accidental)switch(e.accidental){case"sharp":t+="#";break;case"flat":t+="♭";break;case"natural":t+="♮"}return t+=" "+e.octave,t}static getNoteId(e){return`${e.name}${e.octave}${e.clef}${e.accidental||""}`}}class i{static getInstance(){return i.instance||(i.instance=new i),i.instance}constructor(){this.notes=new Map,this.initializeNotes()}initializeNotes(){[{name:"F",position:1,isSpace:!0,clef:"treble",octave:4},{name:"A",position:2,isSpace:!0,clef:"treble",octave:4},{name:"C",position:3,isSpace:!0,clef:"treble",octave:5},{name:"E",position:4,isSpace:!0,clef:"treble",octave:5},{name:"E",position:1,isSpace:!1,clef:"treble",octave:4},{name:"G",position:2,isSpace:!1,clef:"treble",octave:4},{name:"B",position:3,isSpace:!1,clef:"treble",octave:4},{name:"D",position:4,isSpace:!1,clef:"treble",octave:5},{name:"F",position:5,isSpace:!1,clef:"treble",octave:5},{name:"D",position:0,isSpace:!0,clef:"treble",octave:4},{name:"C",position:0,isSpace:!1,clef:"treble",octave:4},{name:"G",position:5,isSpace:!0,clef:"treble",octave:5},{name:"A",position:6,isSpace:!1,clef:"treble",octave:5},{name:"B",position:6,isSpace:!0,clef:"treble",octave:5},{name:"C",position:7,isSpace:!1,clef:"treble",octave:6},{name:"A",position:1,isSpace:!0,clef:"bass",octave:2},{name:"C",position:2,isSpace:!0,clef:"bass",octave:3},{name:"E",position:3,isSpace:!0,clef:"bass",octave:3},{name:"G",position:4,isSpace:!0,clef:"bass",octave:3},{name:"G",position:1,isSpace:!1,clef:"bass",octave:2},{name:"B",position:2,isSpace:!1,clef:"bass",octave:2},{name:"D",position:3,isSpace:!1,clef:"bass",octave:3},{name:"F",position:4,isSpace:!1,clef:"bass",octave:3},{name:"A",position:5,isSpace:!1,clef:"bass",octave:3},{name:"B",position:5,isSpace:!0,clef:"bass",octave:3},{name:"F",position:0,isSpace:!0,clef:"bass",octave:2},{name:"E",position:0,isSpace:!1,clef:"bass",octave:2},{name:"D",position:-1,isSpace:!0,clef:"bass",octave:2},{name:"C",position:-1,isSpace:!1,clef:"bass",octave:2},{name:"C",position:0,isSpace:!1,clef:"treble",octave:4,accidental:"sharp"},{name:"D",position:0,isSpace:!0,clef:"treble",octave:4,accidental:"sharp"},{name:"F",position:1,isSpace:!0,clef:"treble",octave:4,accidental:"sharp"},{name:"G",position:2,isSpace:!1,clef:"treble",octave:4,accidental:"sharp"},{name:"A",position:2,isSpace:!0,clef:"treble",octave:4,accidental:"sharp"},{name:"C",position:3,isSpace:!0,clef:"treble",octave:5,accidental:"sharp"},{name:"D",position:4,isSpace:!1,clef:"treble",octave:5,accidental:"sharp"},{name:"F",position:5,isSpace:!1,clef:"treble",octave:5,accidental:"sharp"},{name:"G",position:5,isSpace:!0,clef:"treble",octave:5,accidental:"sharp"},{name:"A",position:6,isSpace:!1,clef:"treble",octave:5,accidental:"sharp"},{name:"C",position:-1,isSpace:!1,clef:"bass",octave:2,accidental:"sharp"},{name:"D",position:-1,isSpace:!0,clef:"bass",octave:2,accidental:"sharp"},{name:"F",position:0,isSpace:!0,clef:"bass",octave:2,accidental:"sharp"},{name:"G",position:1,isSpace:!1,clef:"bass",octave:2,accidental:"sharp"},{name:"A",position:1,isSpace:!0,clef:"bass",octave:2,accidental:"sharp"},{name:"C",position:2,isSpace:!0,clef:"bass",octave:3,accidental:"sharp"},{name:"D",position:3,isSpace:!1,clef:"bass",octave:3,accidental:"sharp"},{name:"F",position:4,isSpace:!1,clef:"bass",octave:3,accidental:"sharp"},{name:"G",position:4,isSpace:!0,clef:"bass",octave:3,accidental:"sharp"},{name:"A",position:5,isSpace:!1,clef:"bass",octave:3,accidental:"sharp"}].forEach((e=>{this.notes.set(this.getNoteKey(e.name,e.accidental,e.octave),e)}))}getNoteKey(e,t,n){return`${e}${t||""}${n}`}getNote(e,t,n){return this.notes.get(this.getNoteKey(e,t,n))}getAllNotes(){return Array.from(this.notes.values())}getNotesByClef(e){return Array.from(this.notes.values()).filter((t=>t.clef===e))}getWhiteNotesByClef(e){return Array.from(this.notes.values()).filter((t=>t.clef===e&&!t.accidental))}getBlackNotesByClef(e){return Array.from(this.notes.values()).filter((t=>t.clef===e&&t.accidental))}getNotesInRange(e,t){return Array.from(this.notes.values()).filter((n=>n.octave>=e&&n.octave<=t))}}const a=i.getInstance(),s=a.getAllNotes(),r=a.getWhiteNotesByClef("treble"),l=a.getWhiteNotesByClef("bass"),c=r.filter((e=>e.isSpace&&e.position>0&&e.position<5)),d=[...r.filter((e=>!e.isSpace&&!o.isLedgerLineNote(e))),...r.filter((e=>"G"===e.name&&5===e.octave)),...r.filter((e=>o.isBelowStaff(e))),...l.filter((e=>!o.isLedgerLineNote(e))),...r.filter((e=>o.isAboveStaff(e))),...r.filter((e=>o.isLedgerLineNote(e))),...l.filter((e=>o.isLedgerLineNote(e))),...a.getBlackNotesByClef("treble"),...a.getBlackNotesByClef("bass")],p=e=>{const t=Math.min(e,50)/50;return{requiredSuccessCount:Math.round(15+20*t),maxTimePerProblem:Number((6-5*t).toFixed(1))}};class h{static generateLevels(){const e=[];e.push({id:1,name:"Treble Clef Spaces",description:"Learn the notes in the spaces of the treble clef (F, A, C, E)",clef:"treble",notes:c,...p(1)});let t=[...c];for(let n=0;n<d.length;n++){const i=d[n],a=n+2;e.push({id:a,name:`Learning ${o.getNoteLabel(i)}`,description:`Learn the note ${i.name} on the ${i.clef} clef`,clef:i.clef,notes:[...t,i],newNote:i,learnedNotes:t,...p(a)}),t=[...t,i]}const n=d.length+2;return e.push({id:n,name:"Master Level",description:"Practice all notes on both the treble and bass clefs",clef:"treble",notes:s,...p(n),maxTimePerProblem:1}),e}static get levels(){return this.generateLevels()}}h.NEW_NOTE_FREQUENCY=.2,h.allNotes=s,h.LEVEL_CRITERIA={requiredSuccessCount:15,maxTimePerProblem:3};class u{constructor(e,t){this.currentNote=null,this.lastNoteAsked=null,this.mistakenNotesPool=new Map,this.config=e,this.notes=[...e.notes],this.levelIndex=t,this.selectAndSetNextNote()}getCurrentNote(){return this.currentNote||(console.error("Current note is null, selecting a new one."),this.selectAndSetNextNote()),this.currentNote}getAvailableNotes(){return this.notes}nextNote(){this.selectAndSetNextNote()}selectAndSetNextNote(){let e=null,t=0,n="";if(0!==this.config.notes.length){do{t++;const o=Math.random();let i=[];const a=this.getRecentlyLearnedNotes(),s=Array.from(this.mistakenNotesPool.values()).map((e=>e.note)),r=this.levelIndex>=5&&a.length>0?.4:0;let l=r+(s.length>0?.3:0),c=l+(this.config.newNote?.2:0);if(o<r&&a.length>0?(i=a,n="Recently Learned"):o<l&&s.length>0?(i=s,n="Mistaken"):o<c&&this.config.newNote?(i=[this.config.newNote],n="New Note"):(i=this.config.notes,n="Learned (All Level Notes)"),i.length>0)e=i[Math.floor(Math.random()*i.length)];else{if(console.warn(`Selected pool '${n}' was empty. Falling back to all level notes.`),i=this.config.notes,!(i.length>0)){console.error("Absolute fallback failed: Level has no notes at all.");break}e=i[Math.floor(Math.random()*i.length)],n="Learned (Fallback)"}if(t>10&&this.config.notes.length>1){console.warn("Could not find a different note after 10 attempts. Allowing potential repeat.");break}if(this.config.notes.length<=1)break}while(this.lastNoteAsked&&e&&this.isSameNote(e,this.lastNoteAsked));e?(this.currentNote=e,this.lastNoteAsked=this.currentNote):!this.currentNote&&this.config.notes.length>0?(this.currentNote=this.config.notes[0],this.lastNoteAsked=this.currentNote,console.error("Failed to select any note initially, assigned the first note of the level.")):e||console.warn(`Selection failed or resulted in same note. Keeping current note: ${this.currentNote?o.getNoteLabel(this.currentNote):"null"}`)}else console.error(`Level ${this.levelIndex} has no notes defined.`)}updateMistakenNotes(e,t){const n=o.getNoteId(e);if(t){if(this.mistakenNotesPool.has(n)){const e=this.mistakenNotesPool.get(n);e.consecutiveCorrect++,e.consecutiveCorrect>=3?this.mistakenNotesPool.delete(n):this.mistakenNotesPool.set(n,e)}}else this.mistakenNotesPool.set(n,{note:e,consecutiveCorrect:0})}getRecentlyLearnedNotes(){const e=[],t=h.levels,n=this.levelIndex-1,o=Math.max(0,this.levelIndex-5);for(let i=n;i>=o;i--)if(i>=0&&i<t.length){const n=t[i];n?.newNote&&(e.some((e=>this.isSameNote(e,n.newNote)))||e.push(n.newNote))}return e}isSameNote(e,t){return!(!e||!t)&&o.getNoteId(e)===o.getNoteId(t)}isComplete(e){const t=this.config.requiredSuccessCount||h.LEVEL_CRITERIA.requiredSuccessCount,n=this.config.maxTimePerProblem||h.LEVEL_CRITERIA.maxTimePerProblem;let o=0;for(let t=e.length-1;t>=0&&e[t].isCorrect;t--)o++;if(o<t)return!1;const i=e.slice(-o);return i.reduce(((e,t)=>e+t.timeSpent),0)/i.length<n}}class m{constructor(e){this.width=700,this.height=300,this.lineSpacing=15,this.staffY=150,this.imagesLoaded=!1;const t=document.getElementById(e);if(!t)throw new Error(`Container element with id '${e}' not found`);this.container=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height;const n=this.canvas.getContext("2d");if(!n)throw new Error("Failed to get canvas context");this.ctx=n,this.container.appendChild(this.canvas),this.trebleClefImg=new Image,this.bassClefImg=new Image,this.trebleClefImg.onerror=e=>{console.error("Failed to load treble clef image:",e)},this.bassClefImg.onerror=e=>{console.error("Failed to load bass clef image:",e)};let o=0;const i=()=>{o++,2===o&&(this.imagesLoaded=!0,this.drawStaff())};this.trebleClefImg.onload=i,this.bassClefImg.onload=i;const a=["./imgs/treble_clef.png","../imgs/treble_clef.png","../../imgs/treble_clef.png","imgs/treble_clef.png","/imgs/treble_clef.png"];this.loadTrebleClefFromPaths(a,0);const s=a.map((e=>e.replace("treble","bass")));this.loadBassClefFromPaths(s,0),this.drawStaff()}loadTrebleClefFromPaths(e,t){t>=e.length?console.error("Failed to load treble clef from any path"):(this.trebleClefImg.src=e[t],setTimeout((()=>{this.imagesLoaded||this.loadTrebleClefFromPaths(e,t+1)}),500))}loadBassClefFromPaths(e,t){t>=e.length?console.error("Failed to load bass clef from any path"):(this.bassClefImg.src=e[t],setTimeout((()=>{this.imagesLoaded||this.loadBassClefFromPaths(e,t+1)}),500))}renderNote(e){this.clear(),this.drawStaff(),this.drawClef(e.clef),this.drawLedgerLinesForNote(e),this.drawNote(e)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}drawStaff(){this.ctx.strokeStyle="black",this.ctx.lineWidth=2;for(let e=0;e<5;e++){const t=this.staffY+(e-2)*this.lineSpacing*2;this.ctx.beginPath(),this.ctx.moveTo(70,t),this.ctx.lineTo(this.width-70,t),this.ctx.stroke()}}drawClef(e){this.imagesLoaded&&("treble"===e?this.ctx.drawImage(this.trebleClefImg,80,this.staffY-65,50,130):this.ctx.drawImage(this.bassClefImg,80,this.staffY-45,50,90))}drawNote(e){let t;t=e.position<=0||e.position>5?("treble"===e.clef||e.position,e.isSpace?this.staffY+(2-e.position)*this.lineSpacing*2+this.lineSpacing:this.staffY+(2-e.position+1)*this.lineSpacing*2):(e.clef,e.isSpace?this.staffY+(2-e.position)*this.lineSpacing*2+this.lineSpacing:this.staffY+(2-e.position+1)*this.lineSpacing*2);const n=this.width/2;if(this.ctx.fillStyle="black",this.ctx.beginPath(),this.ctx.ellipse(n,t,13.28,13.28,0,0,2*Math.PI),this.ctx.fill(),this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(n+13.28,t),this.ctx.lineTo(n+13.28,t-50),this.ctx.stroke(),e.accidental){this.ctx.fillStyle="black",this.ctx.font="28px Arial";let o="";switch(e.accidental){case"sharp":o="♯";break;case"flat":o="♭";break;case"natural":o="♮"}this.ctx.fillText(o,n-39,t+7)}}drawLedgerLines(e,t,n,o,i){if(this.ctx.save(),o<=0){const n=t+3*this.lineSpacing*2;this.ctx.fillStyle="#ffffdd",this.ctx.fillRect(e-35,n-2,70,4),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(e-30,n),this.ctx.lineTo(e+30,n),this.ctx.stroke()}else if(o>5){const n=t-2*this.lineSpacing,i=t-4*this.lineSpacing;this.ctx.fillStyle="#ffffdd",this.ctx.fillRect(e-35,n-2,70,4),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(e-30,n),this.ctx.lineTo(e+30,n),this.ctx.stroke(),o>=7&&(this.ctx.fillStyle="#ffffdd",this.ctx.fillRect(e-35,i-2,70,4),this.ctx.strokeStyle="#000000",this.ctx.lineWidth=3,this.ctx.beginPath(),this.ctx.moveTo(e-30,i),this.ctx.lineTo(e+30,i),this.ctx.stroke())}this.ctx.restore()}areImagesLoaded(){return this.imagesLoaded}drawLedgerLinesForNote(e){if(!o.isLedgerLineNote(e))return;const t=this.width/2;this.ctx.strokeStyle="black",this.ctx.lineWidth=2;const n=18;if(o.isBelowStaff(e)){const o=this.staffY+4*this.lineSpacing;if("treble"===e.clef){const i=o+2*this.lineSpacing;if(this.ctx.beginPath(),this.ctx.moveTo(t-n,i),this.ctx.lineTo(t+n,i),this.ctx.stroke(),e.position<=-1){const e=i+4*this.lineSpacing;this.ctx.beginPath(),this.ctx.moveTo(t-n,e),this.ctx.lineTo(t+n,e),this.ctx.stroke()}}else{const i=o+2*this.lineSpacing;if(this.ctx.beginPath(),this.ctx.moveTo(t-n,i),this.ctx.lineTo(t+n,i),this.ctx.stroke(),e.position<=-2){const e=i+4*this.lineSpacing;this.ctx.beginPath(),this.ctx.moveTo(t-n,e),this.ctx.lineTo(t+n,e),this.ctx.stroke()}}}else if(o.isAboveStaff(e)){const o=this.staffY-2*this.lineSpacing*2-2*this.lineSpacing,i=o-2*this.lineSpacing;this.ctx.beginPath(),this.ctx.moveTo(t-n,o),this.ctx.lineTo(t+n,o),this.ctx.stroke(),e.position>=7&&(this.ctx.beginPath(),this.ctx.moveTo(t-n,i),this.ctx.lineTo(t+n,i),this.ctx.stroke())}}}class f{constructor(e){this.storageKey=e}saveState(e){try{const t=JSON.stringify(e);localStorage.setItem(this.storageKey,t)}catch(e){console.error("Failed to save game state:",e)}}loadState(){try{const e=localStorage.getItem(this.storageKey);if(null===e)return null;const t=JSON.parse(e);return this.isValidGameState(t)?t:(console.warn("Invalid game state found in storage, clearing..."),this.clearState(),null)}catch(e){return console.error("Failed to load game state, clearing corrupt data:",e),this.clearState(),null}}isValidGameState(e){return!(!e||"object"!=typeof e||"number"!=typeof e.currentLevelIndex||"boolean"!=typeof e.isGameRunning||!e.noteHistory||"object"!=typeof e.noteHistory||(e.recentAttempts||(e.recentAttempts=[]),Array.isArray(e.recentAttempts)||(e.recentAttempts=[]),0))}clearState(){try{localStorage.removeItem(this.storageKey)}catch(e){console.error("Failed to clear game state:",e)}}}class g{constructor(e){this.showNoteNames=!0,this.showAllKeys=!1,this.currentClef="treble",this.whiteKeys=["C","D","E","F","G","A","B"],this.blackKeys=["C#","D#","F#","G#","A#"],this.trebleClefStartOctave=4,this.bassClefStartOctave=2,this.middleC=4;const t=document.getElementById(e);if(!t)throw new Error(`Container element with id '${e}' not found`);this.container=t,this.noteRepository=i.getInstance()}setCurrentClef(e){this.currentClef=e}renderKeyboard(e,t,n){this.container.innerHTML="",n&&(this.currentClef=n);const o=document.createElement("div");o.className="keyboards-container";const i="treble"===this.currentClef,a=i?"Treble Clef (C4-C6)":"Bass Clef (C2-C4)",s=i?this.trebleClefStartOctave:this.bassClefStartOctave,r=document.createElement("div");r.className="piano-keyboard",r.dataset.clef=this.currentClef;const l=document.createElement("div");l.className="keyboard-label",l.textContent=a,r.appendChild(l);const c=this.createKeyboardKeys(s,e,t);r.appendChild(c),o.appendChild(r),this.container.appendChild(o)}createKeyboardKeys(e,t,n){const o=document.createElement("div");o.className="keyboard-keys";const i=document.createElement("div");i.className="octave",this.createOctaveKeys(i,e,t,n),o.appendChild(i);const a=document.createElement("div");a.className="octave",this.createOctaveKeys(a,e+1,t,n),o.appendChild(a);const s=document.createElement("div");s.className="octave third-octave";const r=e+2;return this.createPianoKey(s,"C",r,t,n,"white-key"),o.appendChild(s),o}createOctaveKeys(e,t,n,o){for(const i of this.whiteKeys)this.createPianoKey(e,i,t,n,o,"white-key");for(const i of this.blackKeys){const a=i.charAt(0),s=this.createPianoKey(e,a,t,n,o,"black-key","sharp");switch(a){case"C":s.style.left="10%";break;case"D":s.style.left="24%";break;case"F":s.style.left="53%";break;case"G":s.style.left="67%";break;case"A":s.style.left="81%"}}}createPianoKey(e,t,n,o,i,a,s){const r=document.createElement("div");r.className=`piano-key ${a}`,"C"!==t||n!==this.middleC||s||r.classList.add("middle-c");const l=this.noteRepository.getNote(t,s,n);if(!l)return r;const c=this.findMatchingNote(l,o);if(this.showAllKeys||c?(r.classList.add("selectable"),r.addEventListener("click",(()=>i(l)))):r.classList.add("disabled"),this.showNoteNames&&"white-key"===a){const e=document.createElement("span");e.className="note-name",e.textContent=t,r.appendChild(e)}return e.appendChild(r),r}findMatchingNote(e,t){return t.find((t=>{const n=t.name.toLowerCase()===e.name.toLowerCase(),o=t.octave===e.octave,i=t.accidental===e.accidental||!t.accidental&&!e.accidental;return n&&o&&i}))}toggleNoteNames(){this.showNoteNames=!this.showNoteNames}toggleShowAllKeys(){this.showAllKeys=!this.showAllKeys}}class b{constructor(e){this.storageKey=e+"-profiles",this.profilesState=this.loadProfilesState()||{activeProfileId:null,profiles:[]}}loadProfilesState(){try{const e=localStorage.getItem(this.storageKey);if(!e)return null;const t=JSON.parse(e);return this.isValidProfilesState(t)?t:(console.warn("Invalid profiles state found in storage, resetting..."),null)}catch(e){return console.error("Failed to load profiles state:",e),null}}isValidProfilesState(e){if(!e||"object"!=typeof e)return!1;if(!Array.isArray(e.profiles))return!1;for(const t of e.profiles){if(!t.id||!t.name||!t.gameState)return!1;if("number"!=typeof t.createdAt||"number"!=typeof t.lastUsed)return!1;t.displayPreferences||(t.displayPreferences={showNoteNames:!0,showAllNotes:!1})}return!0}saveProfilesState(){try{const e=JSON.stringify(this.profilesState);localStorage.setItem(this.storageKey,e)}catch(e){console.error("Failed to save profiles state:",e)}}createProfile(e){const t=Date.now().toString(36)+Math.random().toString(36).substr(2),n=Date.now(),o={id:t,name:e,gameState:{currentLevelIndex:0,isGameRunning:!1,noteHistory:{},recentAttempts:[]},createdAt:n,lastUsed:n,displayPreferences:{showNoteNames:!0,showAllNotes:!1}};return this.profilesState.profiles.push(o),this.profilesState.activeProfileId||(this.profilesState.activeProfileId=t),this.saveProfilesState(),o}removeProfile(e){const t=this.profilesState.profiles.length;return this.profilesState.profiles=this.profilesState.profiles.filter((t=>t.id!==e)),this.profilesState.activeProfileId===e&&(this.profilesState.activeProfileId=this.profilesState.profiles.length>0?this.profilesState.profiles[0].id:null),this.saveProfilesState(),t!==this.profilesState.profiles.length}updateProfileName(e,t){const n=this.profilesState.profiles.find((t=>t.id===e));return!!n&&(n.name=t,this.saveProfilesState(),!0)}setActiveProfile(e){const t=this.profilesState.profiles.find((t=>t.id===e));return!!t&&(this.profilesState.activeProfileId=e,t.lastUsed=Date.now(),this.saveProfilesState(),!0)}getActiveProfile(){return this.profilesState.activeProfileId&&this.profilesState.profiles.find((e=>e.id===this.profilesState.activeProfileId))||null}updateActiveProfileGameState(e){const t=this.getActiveProfile();return!!t&&(t.gameState=e,t.lastUsed=Date.now(),this.saveProfilesState(),!0)}getAllProfiles(){return[...this.profilesState.profiles]}clearAllProfiles(){this.profilesState={activeProfileId:null,profiles:[]},this.saveProfilesState()}updateActiveProfileDisplayPreferences(e){const t=this.getActiveProfile();return!!t&&(t.displayPreferences||(t.displayPreferences={showNoteNames:!0,showAllNotes:!1}),t.displayPreferences={...t.displayPreferences,...e},t.lastUsed=Date.now(),this.saveProfilesState(),!0)}getActiveProfileDisplayPreferences(){const e=this.getActiveProfile();return e?(e.displayPreferences||(e.displayPreferences={showNoteNames:!0,showAllNotes:!1},this.saveProfilesState()),e.displayPreferences):null}isValidGameState(e){return!(!e||"object"!=typeof e||"number"!=typeof e.currentLevelIndex||"boolean"!=typeof e.isGameRunning||!e.noteHistory||"object"!=typeof e.noteHistory||(e.recentAttempts||(e.recentAttempts=[]),Array.isArray(e.recentAttempts)||(e.recentAttempts=[]),0))}}class x{constructor(){this.audioContext=null,this.isInitialized=!1,this.isTestEnvironment=!1,this.fallbackAudio=null,this.useAudioElementFallback=!1,this.isTestEnvironment="undefined"==typeof window||void 0===(window.AudioContext||window.webkitAudioContext),this.isTestEnvironment||this.createFallbackAudio()}createFallbackAudio(){try{this.fallbackAudio=document.createElement("audio");const e="UklGRjQrAABXQVZFZm10IBAAAAABAAEARKwAAESsAAABAAgAZGF0YRAr";this.fallbackAudio.src=`data:audio/wav;base64,${e}`,this.fallbackAudio.volume=.5,this.fallbackAudio.style.display="none",document.body.appendChild(this.fallbackAudio),document.addEventListener("touchstart",(()=>{this.fallbackAudio&&this.fallbackAudio.load()}),{once:!0})}catch(e){console.error("Failed to create fallback audio:",e)}}static getInstance(){return x.instance||(x.instance=new x),x.instance}getAudioContextState(){return this.audioContext?this.audioContext.state:"not initialized"}initialize(){if(!this.isInitialized&&!this.isTestEnvironment)try{const e=window.AudioContext||window.webkitAudioContext;this.audioContext=new e,this.isInitialized=!0,this.forceResumeContext(),console.log(`AudioContext initialized with state: ${this.audioContext.state}`)}catch(e){console.error("Failed to initialize AudioContext:",e)}}forceResumeContext(){this.audioContext?"suspended"===this.audioContext.state&&(console.log("Attempting to resume suspended AudioContext..."),this.audioContext.resume().then((()=>{console.log(`AudioContext resumed: ${this.audioContext?.state}`),this.playSilentSound()})).catch((e=>{console.error("Failed to resume AudioContext:",e)}))):this.initialize()}playSilentSound(){if(this.audioContext)try{const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();t.gain.value=.001,e.connect(t),t.connect(this.audioContext.destination),e.start(this.audioContext.currentTime),e.stop(this.audioContext.currentTime+.001),console.log("Silent sound played to unlock audio")}catch(e){console.error("Error playing silent sound:",e)}}testSound(){if(!this.isTestEnvironment)if(this.forceResumeContext(),this.audioContext)try{console.log("Playing test sound...");const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(440,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.5,this.audioContext.currentTime+.01),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),e.connect(t),t.connect(this.audioContext.destination),e.start(),e.stop(this.audioContext.currentTime+.5),console.log("Test sound triggered, AudioContext state:",this.audioContext.state)}catch(e){console.error("Error playing test sound:",e),this.playFallbackBeep()}else console.error("Cannot play test sound - AudioContext not available")}playNote(e,t){if(!this.isTestEnvironment)if(this.forceResumeContext(),this.audioContext)try{const n=this.audioContext.createOscillator(),o=this.audioContext.createGain(),i=this.getNoteFrequency(e,t);n.type="sine",n.frequency.setValueAtTime(i,this.audioContext.currentTime),o.gain.setValueAtTime(0,this.audioContext.currentTime),o.gain.linearRampToValueAtTime(.5,this.audioContext.currentTime+.01),o.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+1.5),n.connect(o),o.connect(this.audioContext.destination),n.start(),n.stop(this.audioContext.currentTime+1.5)}catch(e){console.error("Error playing note:",e),this.playFallbackBeep()}else console.error("Cannot play note - AudioContext not available")}playErrorSound(){if(!this.isTestEnvironment)if(this.forceResumeContext(),this.audioContext)try{const e=this.audioContext.createOscillator(),t=this.audioContext.createGain();e.type="sine",e.frequency.setValueAtTime(80,this.audioContext.currentTime),t.gain.setValueAtTime(0,this.audioContext.currentTime),t.gain.linearRampToValueAtTime(.6,this.audioContext.currentTime+.02),t.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+.5),e.connect(t),t.connect(this.audioContext.destination),e.start(),e.stop(this.audioContext.currentTime+.5)}catch(e){console.error("Error playing error sound:",e),this.playFallbackBeep()}else console.error("Cannot play error sound - AudioContext not available")}playSuccessSound(){if(!this.isTestEnvironment)if(this.forceResumeContext(),this.audioContext)try{this.playSuccessNote(261.63,0,.15),this.playSuccessNote(329.63,.15,.15),this.playSuccessNote(392,.3,.15),this.playSuccessNote(523.25,.45,.3)}catch(e){console.error("Error playing success sound:",e),this.playFallbackBeep()}else console.error("Cannot play success sound - AudioContext not available")}playSuccessNote(e,t,n){if(!this.audioContext)return;const o=this.audioContext.createOscillator(),i=this.audioContext.createGain();o.type="triangle",o.frequency.setValueAtTime(e,this.audioContext.currentTime+t),i.gain.setValueAtTime(0,this.audioContext.currentTime+t),i.gain.linearRampToValueAtTime(.7,this.audioContext.currentTime+t+.01),i.gain.exponentialRampToValueAtTime(.01,this.audioContext.currentTime+t+n),o.connect(i),i.connect(this.audioContext.destination),o.start(this.audioContext.currentTime+t),o.stop(this.audioContext.currentTime+t+n)}playFallbackBeep(){try{const e=new Audio;e.src="data:audio/wav;base64,UklGRjQrAABXQVZFZm10IBAAAAABAAEARKwAAESsAAABAAgAZGF0YRAr",e.volume=1;const t=e.play();void 0!==t&&t.then((()=>{console.log("Fallback audio played successfully")})).catch((e=>{console.error("Fallback audio failed:",e)}))}catch(e){console.error("All audio methods failed:",e)}}getNoteFrequency(e,t){const n=12*(t-4)+(({C:0,"C#":1,Db:1,D:2,"D#":3,Eb:3,E:4,F:5,"F#":6,Gb:6,G:7,"G#":8,Ab:8,A:9,"A#":10,Bb:10,B:11}[e]||0)-9);return 440*Math.pow(2,n/12)}}const v=[{name:"Mickey Mouse",messages:["Hot dog! You're on a roll!","Oh boy! Keep up the great work!","Gosh, you're getting good at this!"],avatar:"./imgs/mickeymouse.jpg"},{name:"SpongeBob",messages:["I'm ready! You're ready! For more notes!","Sweet victory! Keep it up!","That's the spirit! You're doing great!"],avatar:"./imgs/spongebob.png"},{name:"Bugs Bunny",messages:["Eh, what's up, Doc? Nice streak you got there!","That's all folks... Just kidding, keep going!","You're doing swell, Doc!"],avatar:"./imgs/bugsbunny.jpg"},{name:"Pikachu",messages:["Pika Pika! You're electrifying!","Pikachu is impressed by your skills!","Pika Pi! You're on fire!"],avatar:"./imgs/pikachu.jpg"},{name:"Homer Simpson",messages:["Woo hoo! Four correct notes!","Mmm... musical notes...","D'oh! I mean... Bravo!"],avatar:"./imgs/homersimpson.jpg"}];class y{constructor(){this.currentLevel=null,this.profileNameElement=null,this.levelNameElement=null,this.noteDisplayTime=0,this.lastStreakAnimation=0,this.characterElement=null,this.state={currentLevelIndex:0,isGameRunning:!1,noteHistory:{},recentAttempts:[]},this.noteRepository=i.getInstance(),this.audioPlayer=x.getInstance(),this.sheetRenderer=new m("sheet-music"),this.keyboardRenderer=new g("note-options"),this.storageManager=new f("music-reading-game"),this.profileManager=new b("music-reading-game"),this.noteOptionsContainer=document.getElementById("note-options"),this.feedbackElement=document.getElementById("feedback"),this.streakElement=document.getElementById("streak-value"),this.speedElement=document.getElementById("speed-value"),this.streakRequiredElement=document.getElementById("streak-required"),this.speedRequiredElement=document.getElementById("speed-required"),this.streakDisplayElement=document.getElementById("streak-display"),this.errorModalElement=document.getElementById("error-modal"),this.errorMessageElement=document.getElementById("error-message"),this.errorModalCloseElement=document.querySelector(".error-modal-close"),this.errorModalButtonElement=document.getElementById("error-modal-button"),this.errorModalCloseElement&&this.errorModalCloseElement.addEventListener("click",(()=>this.closeErrorModal())),this.errorModalButtonElement&&this.errorModalButtonElement.addEventListener("click",(()=>this.closeErrorModal())),this.profileNameElement=document.getElementById("profile-name"),this.levelNameElement=document.getElementById("level-name");const e=this.profileManager.getActiveProfile();e?(this.state=e.gameState,this.applyDisplayPreferences(),this.state.isGameRunning&&this.waitForImagesAndStartGame()):this.createDefaultProfile(),this.updateStats(),this.updateProfileDisplay(),document.addEventListener("click",(()=>{this.audioPlayer&&this.audioPlayer.initialize()}),{once:!0})}createDefaultProfile(){const e=this.profileManager.createProfile("Player 1");this.state=e.gameState}getAllProfiles(){const e=this.profileManager.getAllProfiles(),t=this.profileManager.getActiveProfile();return e.map((e=>({id:e.id,name:e.name,isActive:!!t&&e.id===t.id,lastUsed:e.lastUsed})))}getActiveProfile(){const e=this.profileManager.getActiveProfile();return e?{id:e.id,name:e.name,displayPreferences:e.displayPreferences}:null}createProfile(e){this.profileManager.createProfile(e),this.updateProfileDisplay()}removeProfile(e){this.profileManager.removeProfile(e);const t=this.profileManager.getActiveProfile();t&&(this.state=t.gameState,this.updateStats()),this.updateProfileDisplay()}updateProfileName(e,t){this.profileManager.updateProfileName(e,t),this.updateProfileDisplay()}setActiveProfile(e){if(this.profileManager.setActiveProfile(e)){const e=this.profileManager.getActiveProfile();e&&(this.state=e.gameState,this.applyDisplayPreferences(),this.state.isGameRunning?this.waitForImagesAndStartGame():(this.clearFeedback(),this.clearNoteOptions(),this.sheetRenderer.clear(),document.dispatchEvent(new CustomEvent("gameStateChanged",{detail:{isRunning:!1}}))),this.updateStats(),this.updateProfileDisplay())}}updateProfileDisplay(){if(this.profileNameElement){const e=this.profileManager.getActiveProfile();this.profileNameElement.textContent=e?e.name:"No Profile"}if(this.levelNameElement){const e=h.levels[this.state.currentLevelIndex];this.levelNameElement.textContent=e?`Level ${this.state.currentLevelIndex+1}: ${e.name}`:"No Level"}}start(){this.state.isGameRunning||(this.audioPlayer.initialize(),this.state.isGameRunning=!0,this.saveState(),this.waitForImagesAndStartGame())}setLevel(e){e<0||e>=h.levels.length?console.error(`Level ${e} does not exist.`):(this.state.currentLevelIndex=e,this.state.recentAttempts=[],this.saveState(),this.updateProfileDisplay(),this.state.isGameRunning&&this.loadLevel(e))}isGameRunning(){return this.state.isGameRunning}saveState(){this.profileManager.updateActiveProfileGameState(this.state),this.storageManager.saveState(this.state)}reset(){this.state={currentLevelIndex:0,isGameRunning:!1,noteHistory:{},recentAttempts:[]},this.saveState(),this.updateStats(),this.updateProfileDisplay(),this.clearFeedback(),this.clearNoteOptions(),this.sheetRenderer.clear(),document.dispatchEvent(new CustomEvent("gameStateChanged",{detail:{isRunning:!1}}))}resetAllProfiles(){this.profileManager.clearAllProfiles(),this.createDefaultProfile(),this.reset()}loadLevel(e){const t=h.levels;if(e<0||e>=t.length)return void console.error(`Level ${e} does not exist.`);const n=t[e];if(this.currentLevel=new u(n,e),n.newNote){const e=o.getNoteId(n.newNote);this.state.noteHistory[e]||(this.state.noteHistory[e]={correct:0,incorrect:0})}this.displayCurrentNote(),this.updateLevelRequirements(),this.updateProfileDisplay()}displayCurrentNote(){if(!this.currentLevel)return;const e=this.currentLevel.getCurrentNote();this.sheetRenderer.renderNote(e),this.renderNoteOptions(),this.noteDisplayTime=Date.now()}renderNoteOptions(){if(this.clearNoteOptions(),!this.currentLevel)return;const e=this.currentLevel.getAvailableNotes(),t=this.currentLevel.getCurrentNote();this.keyboardRenderer.renderKeyboard(e,(e=>{this.checkAnswer(e)}),t.clef)}checkAnswer(e){if(!this.currentLevel)return;const t=this.currentLevel.getCurrentNote();if(!t)return void console.error("checkAnswer received null currentNote from Level.");const n=o.getNoteId(t),i=this.currentLevel.isSameNote(t,e);i?this.audioPlayer.playNote(t.name,t.octave):this.audioPlayer.playErrorSound(),this.state.noteHistory[n]||(this.state.noteHistory[n]={correct:0,incorrect:0}),i?this.state.noteHistory[n].correct+=1:this.state.noteHistory[n].incorrect+=1;const a=Date.now(),s=(a-this.noteDisplayTime)/1e3;this.state.recentAttempts||(this.state.recentAttempts=[]),this.state.recentAttempts.push({isCorrect:i,timeSpent:s,timestamp:a});const r=h.levels[this.state.currentLevelIndex],l=(r?.requiredSuccessCount||h.LEVEL_CRITERIA.requiredSuccessCount)+1;this.state.recentAttempts.length>l&&(this.state.recentAttempts=this.state.recentAttempts.slice(-l)),this.currentLevel.updateMistakenNotes(t,i),i?this.showFeedback(!0,`Correct! That's ${o.getNoteLabel(t)}`):t.name===e.name&&t.octave!==e.octave?this.showFeedback(!1,`Incorrect. That was ${o.getNoteLabel(t)}, not ${o.getNoteLabel(e)} (wrong octave)`):this.showFeedback(!1,`Incorrect. That was ${o.getNoteLabel(t)}, not ${o.getNoteLabel(e)}`),this.updateStats(),this.saveState(),setTimeout((()=>{this.moveToNextNote()}),150)}moveToNextNote(){this.currentLevel&&(this.state.recentAttempts&&this.currentLevel.isComplete(this.state.recentAttempts)?this.levelUp():(this.currentLevel.nextNote(),this.displayCurrentNote()))}levelUp(){if(this.state.currentLevelIndex++,this.state.recentAttempts=[],this.saveState(),this.updateProfileDisplay(),this.state.currentLevelIndex<h.levels.length){const e=h.levels[this.state.currentLevelIndex];this.errorMessageElement&&(this.errorMessageElement.textContent=`Level Up! Moving to level ${this.state.currentLevelIndex+1}: ${e.name}`,this.errorModalElement.classList.add("active")),"undefined"!=typeof window&&"undefined"!=typeof document&&this.showLevelUpCelebration(this.state.currentLevelIndex,e.name),setTimeout((()=>{this.closeErrorModal(),this.loadLevel(this.state.currentLevelIndex)}),"undefined"!=typeof window&&"undefined"!=typeof document?3500:2e3)}else this.errorMessageElement&&(this.errorMessageElement.textContent="Congratulations! You've completed all levels!",this.errorModalElement.classList.add("active")),"undefined"!=typeof window&&"undefined"!=typeof document&&this.showLevelUpCelebration(this.state.currentLevelIndex,"Game Complete!",!0),this.state.isGameRunning=!1}showLevelUpCelebration(e,t,n=!1){if("undefined"!=typeof window&&"undefined"!=typeof document)try{this.audioPlayer&&this.audioPlayer.playSuccessSound();const o=document.createElement("div");o.className="level-up-overlay";const i=document.createElement("div");i.className="level-up-container";const a=document.createElement("div");a.className="level-up-message",a.innerHTML=n?"<h1>CONGRATULATIONS!</h1><h2>You completed all levels!</h2>":`<h1>LEVEL UP!</h1><h2>Level ${e+1}</h2><h3>${t}</h3>`;const s=document.createElement("div");s.className="level-up-stars";for(let e=0;e<5;e++){const t=document.createElement("div");t.className="level-up-star",t.style.animationDelay=.1*e+"s",s.appendChild(t)}i.appendChild(s),i.appendChild(a),o.appendChild(i),document.body.appendChild(o);const r=document.querySelector(".celebration-container");if(r){r.innerHTML="";for(let e=0;e<100;e++){const e=document.createElement("div");e.className="confetti-piece level-up-confetti",e.style.left=100*Math.random()+"%",e.style.width=5+15*Math.random()+"px",e.style.height=10+20*Math.random()+"px",e.style.backgroundColor=this.getRandomColor(),e.style.animationDelay=1*Math.random()+"s",e.style.animationDuration=1+3*Math.random()+"s",r.appendChild(e)}for(let e=0;e<20;e++){const e=document.createElement("div");e.className="special-confetti",e.style.left=100*Math.random()+"%",e.style.top=30*Math.random()+"%",e.style.transform=`rotate(${360*Math.random()}deg)`,e.style.animationDelay=.8*Math.random()+"s",r.appendChild(e)}}setTimeout((()=>{document.body&&document.body.contains(o)&&(o.classList.add("fade-out"),setTimeout((()=>{document.body&&document.body.contains(o)&&document.body.removeChild(o)}),500)),r&&(r.innerHTML="")}),3e3)}catch(e){console.error("Error showing level up celebration:",e)}}showFeedback(e,t){e?this.streakDisplayElement&&(this.streakDisplayElement.classList.remove("flash-green"),this.streakDisplayElement.offsetWidth,this.streakDisplayElement.classList.add("flash-green"),this.showCelebration()):this.errorModalElement&&this.errorMessageElement&&(this.errorMessageElement.textContent=t,this.errorModalElement.classList.add("active"),setTimeout((()=>{this.closeErrorModal()}),3e3))}closeErrorModal(){this.errorModalElement&&this.errorModalElement.classList.remove("active")}showCelebration(){const e=document.querySelector(".celebration-container");if(e){e.innerHTML="";for(let t=0;t<20;t++){const t=document.createElement("div");t.className="confetti-piece",t.style.left=100*Math.random()+"%",t.style.width=5+10*Math.random()+"px",t.style.height=10+15*Math.random()+"px",t.style.backgroundColor=this.getRandomColor(),t.style.animationDelay=.5*Math.random()+"s",t.style.animationDuration=1+2*Math.random()+"s",e.appendChild(t)}for(let t=0;t<5;t++){const t=document.createElement("div");t.className="star",t.style.left=100*Math.random()+"%",t.style.top=100*Math.random()+"%",t.style.animationDelay=.5*Math.random()+"s",e.appendChild(t)}setTimeout((()=>{e.innerHTML=""}),3e3)}}getRandomColor(){const e=["#3498db","#e74c3c","#2ecc71","#f39c12","#9b59b6","#1abc9c"];return e[Math.floor(Math.random()*e.length)]}clearFeedback(){this.feedbackElement.textContent="",this.feedbackElement.className="",this.closeErrorModal(),this.streakDisplayElement&&this.streakDisplayElement.classList.remove("flash-green")}calculateCurrentStreak(){if(!this.state.recentAttempts||0===this.state.recentAttempts.length)return 0;let e=0;for(let t=this.state.recentAttempts.length-1;t>=0&&this.state.recentAttempts[t].isCorrect;t--)e++;return e}calculateAverageSpeed(){if(!this.state.recentAttempts||0===this.state.recentAttempts.length)return 0;const e=this.calculateCurrentStreak();if(0===e)return 0;const t=this.state.recentAttempts.slice(-e);return t.reduce(((e,t)=>e+t.timeSpent),0)/t.length}updateStats(){const e=this.calculateCurrentStreak();this.streakElement&&(this.streakElement.textContent=e.toString());const t=this.calculateAverageSpeed();if(this.speedElement&&(this.speedElement.textContent=e>0?t.toFixed(1):"-"),this.updateVisualFeedback(),4===e){const e=Date.now();e-this.lastStreakAnimation>5e3&&(this.showCartoonCharacter(),this.lastStreakAnimation=e)}}updateLevelRequirements(){if(!this.currentLevel)return;const e=h.levels[this.state.currentLevelIndex],t=e?.requiredSuccessCount||h.LEVEL_CRITERIA.requiredSuccessCount,n=e?.maxTimePerProblem||h.LEVEL_CRITERIA.maxTimePerProblem;this.streakRequiredElement&&(this.streakRequiredElement.textContent=t.toString()),this.speedRequiredElement&&(this.speedRequiredElement.textContent=n.toString())}updateVisualFeedback(){if(!this.streakElement||!this.speedElement)return;const e=this.calculateCurrentStreak(),t=this.calculateAverageSpeed(),n=h.levels[this.state.currentLevelIndex],o=n?.requiredSuccessCount||h.LEVEL_CRITERIA.requiredSuccessCount,i=n?.maxTimePerProblem||h.LEVEL_CRITERIA.maxTimePerProblem;this.streakElement.className=e>=o?"stats-value goal-met":e>=o/2?"stats-value progress":"stats-value",this.speedElement.className=t>0&&t<i?"stats-value goal-met":t>0&&t<1.5*i?"stats-value progress":"stats-value"}clearNoteOptions(){this.noteOptionsContainer.innerHTML=""}showCartoonCharacter(){this.removeCharacterElement();const e=v[Math.floor(Math.random()*v.length)],t=e.messages[Math.floor(Math.random()*e.messages.length)];this.characterElement=document.createElement("div"),this.characterElement.className="cartoon-character-popup";const n=`\n            <div class="character-avatar">\n                <img src="${e.avatar}" alt="${e.name}">\n            </div>\n            <div class="character-content">\n                <h3>${e.name}</h3>\n                <p>${t}</p>\n            </div>\n        `;this.characterElement.innerHTML=n,document.body.appendChild(this.characterElement),setTimeout((()=>{this.characterElement&&this.characterElement.classList.add("visible")}),10),setTimeout((()=>{this.removeCharacterElement()}),9e3)}removeCharacterElement(){this.characterElement&&document.body.contains(this.characterElement)&&(this.characterElement.classList.remove("visible"),setTimeout((()=>{this.characterElement&&document.body.contains(this.characterElement)&&(document.body.removeChild(this.characterElement),this.characterElement=null)}),500))}applyDisplayPreferences(){const e=this.profileManager.getActiveProfileDisplayPreferences();e&&this.keyboardRenderer&&("boolean"==typeof e.showNoteNames&&(this.keyboardRenderer.showNoteNames=e.showNoteNames),"boolean"==typeof e.showAllNotes&&(this.keyboardRenderer.showAllKeys=e.showAllNotes))}updateDisplayPreferences(e){const t=this.profileManager.getActiveProfileDisplayPreferences()||{showNoteNames:!0,showAllNotes:!1},n={showNoteNames:void 0!==e.showNoteNames?e.showNoteNames:t.showNoteNames,showAllNotes:void 0!==e.showAllNotes?e.showAllNotes:t.showAllNotes};this.profileManager.updateActiveProfileDisplayPreferences(n)}getDisplayPreferences(){return this.profileManager.getActiveProfileDisplayPreferences()||{showNoteNames:!0,showAllNotes:!1}}waitForImagesAndStartGame(){this.sheetRenderer.areImagesLoaded()?(this.loadLevel(this.state.currentLevelIndex),document.dispatchEvent(new CustomEvent("gameStateChanged",{detail:{isRunning:!0}}))):setTimeout((()=>{this.waitForImagesAndStartGame()}),100)}}var w=n(72),k=n.n(w),C=n(825),N=n.n(C),S=n(659),A=n.n(S),E=n(56),L=n.n(E),P=n(540),T=n.n(P),I=n(113),M=n.n(I),R=n(552),F={};F.styleTagTransform=M(),F.setAttributes=L(),F.insert=A().bind(null,"head"),F.domAPI=N(),F.insertStyleElement=T(),k()(R.A,F),R.A&&R.A.locals&&R.A.locals,document.addEventListener("DOMContentLoaded",(()=>{const e=new y,t=new f("music-reading-game"),n=x.getInstance(),i=document.getElementById("start-button"),a=document.getElementById("reset-button"),s=document.getElementById("clear-storage-button"),r=document.getElementById("stats-button"),l=document.getElementById("toggle-names-button"),c=document.getElementById("toggle-all-keys-button"),d=document.getElementById("profiles-list"),p=document.getElementById("new-profile-name"),u=document.getElementById("add-profile-button");let m=null;const g=document.getElementById("stats-popup"),b=document.querySelector(".close-button"),v=document.getElementById("learned-notes-list"),w=document.getElementById("levels-list"),k=document.getElementById("level-selection");function C(){e.isGameRunning()?i.style.display="none":i.style.display="block"}function N(e,t){d.querySelectorAll(".profile-item").forEach((t=>{t!==e&&t.classList.remove("editing")})),t?e.classList.add("editing"):(e.classList.remove("editing"),m=null)}function S(t,n){const o=n.value.trim();o&&(e.updateProfileName(t,o),A())}function A(){d.innerHTML="";const t=e.getAllProfiles();0!==t.length?(t.sort(((e,t)=>t.lastUsed-e.lastUsed)),t.forEach((t=>{const n=document.createElement("div");n.className="profile-item "+(t.isActive?"active":"");const o=document.createElement("span");o.className="profile-name",o.textContent=t.name;const i=document.createElement("button");i.className="profile-edit-button",i.textContent="Edit";const a=document.createElement("div");a.className="profile-edit-form-inline";const s=document.createElement("input");s.type="text",s.className="edit-profile-input",s.value=t.name,s.placeholder="Profile name";const r=document.createElement("div");r.className="profile-edit-actions";const l=document.createElement("button");l.className="save-profile-button",l.textContent="Save";const c=document.createElement("button");c.className="delete-profile-button danger",c.textContent="Delete";const p=document.createElement("button");p.className="cancel-edit-button",p.textContent="Cancel",i.addEventListener("click",(e=>{e.stopPropagation(),m=t.id,N(n,!0)})),l.addEventListener("click",(e=>{e.stopPropagation(),S(t.id,s),N(n,!1)})),c.addEventListener("click",(n=>{var o;n.stopPropagation(),o=t.id,confirm("Are you sure you want to delete this profile? All progress will be lost.")&&(e.removeProfile(o),A())})),p.addEventListener("click",(e=>{e.stopPropagation(),N(n,!1)})),s.addEventListener("keydown",(e=>{"Enter"===e.key&&(S(t.id,s),N(n,!1))})),r.appendChild(l),r.appendChild(p),r.appendChild(c),a.appendChild(s),a.appendChild(r),n.appendChild(o),n.appendChild(i),n.appendChild(a),n.addEventListener("click",(o=>{const i=o.target;n.classList.contains("editing")||"BUTTON"===i.tagName||"INPUT"===i.tagName||t.isActive||(e.setActiveProfile(t.id),A())})),d.appendChild(n)}))):d.innerHTML='<p class="no-profiles">No profiles available</p>'}C(),document.addEventListener("gameStateChanged",(e=>{C()})),i.addEventListener("click",(()=>{n.initialize(),n.forceResumeContext(),e.start(),C()})),a.addEventListener("click",(()=>{confirm("This will reset your current profile progress. Are you sure?")&&(e.reset(),C(),g.classList.remove("active"))})),s.addEventListener("click",(()=>{confirm("This will reset all profiles and game progress. Are you sure?")&&(e.resetAllProfiles(),alert("All profiles and game progress have been reset!"),g.classList.remove("active"))})),l.addEventListener("click",(()=>{const t=e.keyboardRenderer;if(t){t.toggleNoteNames();const n=t.showNoteNames;if(l.textContent=n?"Hide Note Names":"Show Note Names",e.updateDisplayPreferences({showNoteNames:n}),e.isGameRunning()){const n=e.currentLevel;if(n){const o=n.getAvailableNotes();t.renderKeyboard(o,(t=>{e.checkAnswer(t)}),n.getCurrentNote().clef)}}}})),c.addEventListener("click",(()=>{const t=e.keyboardRenderer;if(t){t.toggleShowAllKeys();const n=t.showAllKeys;if(c.textContent=n?"Hide Unavailable Notes":"Show All Notes",e.updateDisplayPreferences({showAllNotes:n}),e.isGameRunning()){const n=e.currentLevel;if(n){const o=n.getAvailableNotes();t.renderKeyboard(o,(t=>{e.checkAnswer(t)}),n.getCurrentNote().clef)}}}})),r.addEventListener("click",(()=>{A(),function(){v.innerHTML="";const e=t.loadState();if(!e)return void(v.innerHTML="<p>Start the game to see learned notes!</p>");const n=e.currentLevelIndex,i=h.levels;if(n<0||n>=i.length)return void(v.innerHTML="<p>No notes learned yet.</p>");const a=i[n];let s=[];0===n?s=a.notes:a.learnedNotes?(s=[...a.learnedNotes],a.newNote&&s.push(a.newNote)):s=a.notes;const r=s.filter((e=>"treble"===e.clef)),l=s.filter((e=>"bass"===e.clef));if(r.length>0){const e=document.createElement("div");e.className="note-group",e.innerHTML=`\n                <h4>Treble Clef Notes</h4>\n                <div class="level-notes">\n                    ${r.map((e=>`<span class="note-tag">${o.getNoteLabel(e)}</span>`)).join("")}\n                </div>\n            `,v.appendChild(e)}if(l.length>0){const e=document.createElement("div");e.className="note-group",e.innerHTML=`\n                <h4>Bass Clef Notes</h4>\n                <div class="level-notes">\n                    ${l.map((e=>`<span class="note-tag">${o.getNoteLabel(e)}</span>`)).join("")}\n                </div>\n            `,v.appendChild(e)}0===r.length&&0===l.length&&(v.innerHTML="<p>No notes learned yet.</p>")}(),function(){w.innerHTML="";const e=h.levels,n=t.loadState(),i=n?n.currentLevelIndex:-1;e.forEach(((e,t)=>{const n=document.createElement("div");n.className="level-item",t===i&&(n.style.borderLeftColor="#e74c3c");const a=e.notes.map((t=>`<span class="note-tag ${e.newNote&&o.getNoteId(t)===o.getNoteId(e.newNote)?"new":""}">${o.getNoteLabel(t)} (${t.clef})</span>`)).join("");n.innerHTML=`\n                <div class="level-title">Level ${e.id}: ${e.name} ${t===i?"(Current)":""}</div>\n                <div class="level-description">${e.description}</div>\n                <div class="level-notes">\n                    ${a}\n                </div>\n            `,w.appendChild(n)}))}(),function(){k.innerHTML="";const n=t.loadState(),o=n?n.currentLevelIndex:0;h.levels.forEach(((t,n)=>{const i=document.createElement("button");i.className="level-button",n===o&&i.classList.add("current"),i.textContent=`Level ${n+1}: ${t.name}`,i.addEventListener("click",(()=>{e.setLevel(n),g.classList.remove("active"),e.isGameRunning()||(e.start(),C())})),k.appendChild(i)}))}(),function(){const t=e.getActiveProfile();if(t&&t.displayPreferences){const{showNoteNames:e,showAllNotes:n}=t.displayPreferences;l.textContent=e?"Hide Note Names":"Show Note Names",c.textContent=n?"Hide Unavailable Notes":"Show All Notes"}}(),g.classList.add("active")})),b.addEventListener("click",(()=>{g.classList.remove("active")})),u.addEventListener("click",(()=>{const t=p.value.trim();t&&(e.createProfile(t),p.value="",A())})),A()}))})();