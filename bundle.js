(()=>{"use strict";var e={56:(e,t,n)=>{e.exports=function(e){var t=n.nc;t&&e.setAttribute("nonce",t)}},72:e=>{var t=[];function n(e){for(var n=-1,s=0;s<t.length;s++)if(t[s].identifier===e){n=s;break}return n}function s(e,s){for(var r={},i=[],a=0;a<e.length;a++){var l=e[a],c=s.base?l[0]+s.base:l[0],h=r[c]||0,d="".concat(c," ").concat(h);r[c]=h+1;var m=n(d),u={css:l[1],media:l[2],sourceMap:l[3],supports:l[4],layer:l[5]};if(-1!==m)t[m].references++,t[m].updater(u);else{var p=o(u,s);s.byIndex=a,t.splice(a,0,{identifier:d,updater:p,references:1})}i.push(d)}return i}function o(e,t){var n=t.domAPI(t);return n.update(e),function(t){if(t){if(t.css===e.css&&t.media===e.media&&t.sourceMap===e.sourceMap&&t.supports===e.supports&&t.layer===e.layer)return;n.update(e=t)}else n.remove()}}e.exports=function(e,o){var r=s(e=e||[],o=o||{});return function(e){e=e||[];for(var i=0;i<r.length;i++){var a=n(r[i]);t[a].references--}for(var l=s(e,o),c=0;c<r.length;c++){var h=n(r[c]);0===t[h].references&&(t[h].updater(),t.splice(h,1))}r=l}}},113:e=>{e.exports=function(e,t){if(t.styleSheet)t.styleSheet.cssText=e;else{for(;t.firstChild;)t.removeChild(t.firstChild);t.appendChild(document.createTextNode(e))}}},314:e=>{e.exports=function(e){var t=[];return t.toString=function(){return this.map((function(t){var n="",s=void 0!==t[5];return t[4]&&(n+="@supports (".concat(t[4],") {")),t[2]&&(n+="@media ".concat(t[2]," {")),s&&(n+="@layer".concat(t[5].length>0?" ".concat(t[5]):""," {")),n+=e(t),s&&(n+="}"),t[2]&&(n+="}"),t[4]&&(n+="}"),n})).join("")},t.i=function(e,n,s,o,r){"string"==typeof e&&(e=[[null,e,void 0]]);var i={};if(s)for(var a=0;a<this.length;a++){var l=this[a][0];null!=l&&(i[l]=!0)}for(var c=0;c<e.length;c++){var h=[].concat(e[c]);s&&i[h[0]]||(void 0!==r&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=r),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),o&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=o):h[4]="".concat(o)),t.push(h))}},t}},540:e=>{e.exports=function(e){var t=document.createElement("style");return e.setAttributes(t,e.attributes),e.insert(t,e.options),t}},552:(e,t,n)=>{n.d(t,{A:()=>a});var s=n(601),o=n.n(s),r=n(314),i=n.n(r)()(o());i.push([e.id,"* {\n    margin: 0;\n    padding: 0;\n    box-sizing: border-box;\n}\n\nbody {\n    font-family: Arial, sans-serif;\n    line-height: 1.6;\n    background-color: #f4f4f4;\n    color: #333;\n    padding: 20px;\n    font-size: 18px;\n}\n\n.container {\n    max-width: 1000px;\n    margin: 0 auto;\n    padding: 30px;\n    background-color: white;\n    border-radius: 10px;\n    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);\n}\n\nh1 {\n    text-align: center;\n    margin-bottom: 30px;\n    color: #2c3e50;\n    font-size: 36px;\n}\n\n#game-container {\n    margin-bottom: 30px;\n}\n\n#sheet-music {\n    height: 300px;\n    background-color: #f9f9f9;\n    border: 1px solid #ddd;\n    margin-bottom: 30px;\n    display: flex;\n    justify-content: center;\n    align-items: center;\n}\n\n#note-options {\n    display: flex;\n    flex-wrap: wrap;\n    justify-content: center;\n    gap: 15px;\n    margin-bottom: 30px;\n}\n\n.note-button {\n    padding: 15px 30px;\n    background-color: #3498db;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 22px;\n    transition: background-color 0.3s;\n}\n\n.note-button:hover {\n    background-color: #2980b9;\n}\n\n#feedback {\n    text-align: center;\n    height: 32px;\n    margin-bottom: 20px;\n    font-weight: bold;\n    font-size: 24px;\n}\n\n.correct {\n    color: green;\n}\n\n.incorrect {\n    color: red;\n}\n\n#game-stats {\n    font-size: 22px;\n    margin-bottom: 30px;\n}\n\n#score {\n    text-align: center;\n    font-size: 24px;\n    margin-bottom: 30px;\n}\n\n#controls {\n    display: flex;\n    justify-content: center;\n    gap: 15px;\n}\n\nbutton {\n    padding: 15px 30px;\n    background-color: #2c3e50;\n    color: white;\n    border: none;\n    border-radius: 8px;\n    cursor: pointer;\n    font-size: 22px;\n    transition: background-color 0.3s;\n}\n\nbutton:hover {\n    background-color: #1a2530;\n} ",""]);const a=i},601:e=>{e.exports=function(e){return e[1]}},659:e=>{var t={};e.exports=function(e,n){var s=function(e){if(void 0===t[e]){var n=document.querySelector(e);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(e){n=null}t[e]=n}return t[e]}(e);if(!s)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");s.appendChild(n)}},825:e=>{e.exports=function(e){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var t=e.insertStyleElement(e);return{update:function(n){!function(e,t,n){var s="";n.supports&&(s+="@supports (".concat(n.supports,") {")),n.media&&(s+="@media ".concat(n.media," {"));var o=void 0!==n.layer;o&&(s+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),s+=n.css,o&&(s+="}"),n.media&&(s+="}"),n.supports&&(s+="}");var r=n.sourceMap;r&&"undefined"!=typeof btoa&&(s+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(r))))," */")),t.styleTagTransform(s,e,t.options)}(t,e,n)},remove:function(){!function(e){if(null===e.parentNode)return!1;e.parentNode.removeChild(e)}(t)}}}}},t={};function n(s){var o=t[s];if(void 0!==o)return o.exports;var r=t[s]={id:s,exports:{}};return e[s](r,r.exports,n),r.exports}n.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return n.d(t,{a:t}),t},n.d=(e,t)=>{for(var s in t)n.o(t,s)&&!n.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),n.nc=void 0;class s{constructor(e){this.currentNoteIndex=0,this.notePool=[],this.config=e,this.notes=[...e.notes],this.initializeNotePool()}getCurrentNote(){return this.notePool[this.currentNoteIndex]}getAvailableNotes(){return this.notes}nextNote(){this.currentNoteIndex=(this.currentNoteIndex+1)%this.notePool.length}isComplete(e,t=10,n=5){if(e.length<t)return!1;const s=e.slice(-t),o=s.every((e=>e.isCorrect)),r=s.reduce(((e,t)=>e+t.timeSpent),0)/s.length;return o&&r<n}initializeNotePool(){this.notePool=[...this.notes]}updateNotePool(e){this.notePool=[...this.notes];for(const t of this.notes){const n=e[t.name];if(n&&n.incorrect>0){const e=Math.min(5,Math.ceil(n.incorrect/Math.max(1,n.correct)));for(let n=0;n<e;n++)this.notePool.push(t)}}this.shuffleNotePool()}shuffleNotePool(){for(let e=this.notePool.length-1;e>0;e--){const t=Math.floor(Math.random()*(e+1));[this.notePool[e],this.notePool[t]]=[this.notePool[t],this.notePool[e]]}}}const o=[{name:"F",position:1,isSpace:!0,clef:"treble"},{name:"A",position:2,isSpace:!0,clef:"treble"},{name:"C",position:3,isSpace:!0,clef:"treble"},{name:"E",position:4,isSpace:!0,clef:"treble"},{name:"E",position:1,isSpace:!1,clef:"treble"},{name:"G",position:2,isSpace:!1,clef:"treble"},{name:"B",position:3,isSpace:!1,clef:"treble"},{name:"D",position:4,isSpace:!1,clef:"treble"},{name:"F",position:5,isSpace:!1,clef:"treble"}],r=[{name:"A",position:1,isSpace:!0,clef:"bass"},{name:"C",position:2,isSpace:!0,clef:"bass"},{name:"E",position:3,isSpace:!0,clef:"bass"},{name:"G",position:4,isSpace:!0,clef:"bass"},{name:"G",position:1,isSpace:!1,clef:"bass"},{name:"B",position:2,isSpace:!1,clef:"bass"},{name:"D",position:3,isSpace:!1,clef:"bass"},{name:"F",position:4,isSpace:!1,clef:"bass"},{name:"A",position:5,isSpace:!1,clef:"bass"}];class i{}i.levels=[{id:1,name:"Treble Clef Spaces",description:"Learn the notes in the spaces of the treble clef (F, A, C, E)",clef:"treble",notes:o.filter((e=>e.isSpace&&"treble"===e.clef)),requiredSuccessCount:8,maxTimePerProblem:6},{id:2,name:"Treble Clef Lines",description:"Learn the notes on the lines of the treble clef (E, G, B, D, F)",clef:"treble",notes:o.filter((e=>!e.isSpace&&"treble"===e.clef)),requiredSuccessCount:10,maxTimePerProblem:5},{id:3,name:"All Treble Clef Notes",description:"Practice all notes on the treble clef",clef:"treble",notes:o.filter((e=>"treble"===e.clef)),requiredSuccessCount:12,maxTimePerProblem:4},{id:4,name:"Bass Clef Spaces",description:"Learn the notes in the spaces of the bass clef (A, C, E, G)",clef:"bass",notes:r.filter((e=>e.isSpace&&"bass"===e.clef)),requiredSuccessCount:8,maxTimePerProblem:6},{id:5,name:"Bass Clef Lines",description:"Learn the notes on the lines of the bass clef (G, B, D, F, A)",clef:"bass",notes:r.filter((e=>!e.isSpace&&"bass"===e.clef)),requiredSuccessCount:10,maxTimePerProblem:5},{id:6,name:"All Bass Clef Notes",description:"Practice all notes on the bass clef",clef:"bass",notes:r.filter((e=>"bass"===e.clef)),requiredSuccessCount:12,maxTimePerProblem:4},{id:7,name:"Master Level",description:"Practice all notes on both the treble and bass clefs",clef:"treble",notes:[...o,...r],requiredSuccessCount:15,maxTimePerProblem:3}];class a{constructor(e){this.width=700,this.height=300,this.lineSpacing=15,this.staffY=150,this.imagesLoaded=!1;const t=document.getElementById(e);if(!t)throw new Error(`Container element with id '${e}' not found`);this.container=t,this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height;const n=this.canvas.getContext("2d");if(!n)throw new Error("Failed to get canvas context");this.ctx=n,this.container.appendChild(this.canvas),this.trebleClefImg=new Image,this.bassClefImg=new Image,this.trebleClefImg.onerror=e=>{console.error("Failed to load treble clef image:",e)},this.bassClefImg.onerror=e=>{console.error("Failed to load bass clef image:",e)};let s=0;const o=()=>{s++,console.log("Image loaded successfully:",s),2===s&&(this.imagesLoaded=!0,this.drawStaff(),console.log("Clef images loaded and staff drawn"))};this.trebleClefImg.onload=o,this.bassClefImg.onload=o;const r=["./imgs/treble_clef.png","../imgs/treble_clef.png","../../imgs/treble_clef.png","imgs/treble_clef.png","/imgs/treble_clef.png"];this.loadTrebleClefFromPaths(r,0);const i=r.map((e=>e.replace("treble","bass")));this.loadBassClefFromPaths(i,0),this.drawStaff()}loadTrebleClefFromPaths(e,t){t>=e.length?console.error("Failed to load treble clef from any path"):(console.log("Trying to load treble clef from:",e[t]),this.trebleClefImg.src=e[t],setTimeout((()=>{this.imagesLoaded||this.loadTrebleClefFromPaths(e,t+1)}),500))}loadBassClefFromPaths(e,t){t>=e.length?console.error("Failed to load bass clef from any path"):(console.log("Trying to load bass clef from:",e[t]),this.bassClefImg.src=e[t],setTimeout((()=>{this.imagesLoaded||this.loadBassClefFromPaths(e,t+1)}),500))}renderNote(e){this.clear(),this.drawStaff(),this.drawClef(e.clef),this.drawNote(e),console.log(`Rendering ${e.name} note on ${e.clef} clef`)}clear(){this.ctx.clearRect(0,0,this.width,this.height)}drawStaff(){this.ctx.strokeStyle="black",this.ctx.lineWidth=2;for(let e=0;e<5;e++){const t=this.staffY+(e-2)*this.lineSpacing*2;this.ctx.beginPath(),this.ctx.moveTo(70,t),this.ctx.lineTo(this.width-70,t),this.ctx.stroke()}}drawClef(e){this.imagesLoaded?"treble"===e?this.ctx.drawImage(this.trebleClefImg,80,this.staffY-65,50,130):this.ctx.drawImage(this.bassClefImg,80,this.staffY-45,50,90):console.log("Clef images not yet loaded")}drawNote(e){let t;e.clef,t=e.isSpace?this.staffY+(2-e.position)*this.lineSpacing*2+this.lineSpacing:this.staffY+(2-e.position+1)*this.lineSpacing*2;const n=this.width/2;if(this.ctx.fillStyle="black",this.ctx.beginPath(),this.ctx.ellipse(n,t,11.5,11.5,0,0,2*Math.PI),this.ctx.fill(),this.ctx.lineWidth=2,this.ctx.beginPath(),this.ctx.moveTo(n+11,t),this.ctx.lineTo(n+11,t-50),this.ctx.stroke(),e.accidental){this.ctx.fillStyle="black",this.ctx.font="28px Arial";let s="";switch(e.accidental){case"sharp":s="♯";break;case"flat":s="♭";break;case"natural":s="♮"}this.ctx.fillText(s,n-35,t+7)}}}class l{constructor(e){this.storageKey=e}saveState(e){try{const t=JSON.stringify(e);localStorage.setItem(this.storageKey,t)}catch(e){console.error("Failed to save game state:",e)}}loadState(){try{const e=localStorage.getItem(this.storageKey);if(null===e)return null;const t=JSON.parse(e);return this.isValidGameState(t)?t:(console.warn("Invalid game state found in storage, clearing..."),this.clearState(),null)}catch(e){return console.error("Failed to load game state, clearing corrupt data:",e),this.clearState(),null}}isValidGameState(e){return!(!e||"object"!=typeof e||"number"!=typeof e.currentLevelIndex||"boolean"!=typeof e.isGameRunning||!e.noteHistory||"object"!=typeof e.noteHistory||(e.recentAttempts||(e.recentAttempts=[]),Array.isArray(e.recentAttempts)||(e.recentAttempts=[]),0))}clearState(){try{localStorage.removeItem(this.storageKey)}catch(e){console.error("Failed to clear game state:",e)}}}class c{constructor(){this.currentLevel=null,this.noteDisplayTime=0,this.state={currentLevelIndex:0,isGameRunning:!1,noteHistory:{},recentAttempts:[]},this.sheetRenderer=new a("sheet-music"),this.storageManager=new l("music-reading-game"),this.noteOptionsContainer=document.getElementById("note-options"),this.feedbackElement=document.getElementById("feedback"),this.streakElement=document.getElementById("streak-value"),this.speedElement=document.getElementById("speed-value"),this.streakRequiredElement=document.getElementById("streak-required"),this.speedRequiredElement=document.getElementById("speed-required");const e=this.storageManager.loadState();e&&(this.state=e,this.state.recentAttempts||(this.state.recentAttempts=[])),this.updateStats()}start(){this.state.isGameRunning||(this.state.isGameRunning=!0,this.loadLevel(this.state.currentLevelIndex),console.log("Game started!"),this.updateLevelRequirements())}reset(){console.log("Resetting game and clearing storage..."),this.storageManager.clearState(),this.state={currentLevelIndex:0,isGameRunning:!1,noteHistory:{},recentAttempts:[]},this.storageManager.saveState(this.state),this.updateStats(),this.clearFeedback(),this.clearNoteOptions(),this.sheetRenderer.clear(),console.log("Game reset complete.")}loadLevel(e){const t=i.levels[e];t?(console.log(`Loading level ${e}: ${t.name}`),this.currentLevel=new s(t),this.displayCurrentNote(),this.updateLevelRequirements()):console.error(`Level ${e} does not exist.`)}displayCurrentNote(){if(!this.currentLevel)return;const e=this.currentLevel.getCurrentNote();this.sheetRenderer.renderNote(e),this.renderNoteOptions(),this.noteDisplayTime=Date.now()}renderNoteOptions(){this.clearNoteOptions(),this.currentLevel&&this.currentLevel.getAvailableNotes().forEach((e=>{const t=document.createElement("button");t.className="note-button",t.textContent=e.name,t.addEventListener("click",(()=>{this.checkAnswer(e)})),this.noteOptionsContainer.appendChild(t)}))}checkAnswer(e){if(!this.currentLevel)return;const t=this.currentLevel.getCurrentNote(),n=t.name===e.name;this.state.noteHistory[t.name]||(this.state.noteHistory[t.name]={correct:0,incorrect:0});const s=Date.now(),o=(s-this.noteDisplayTime)/1e3;this.state.recentAttempts||(this.state.recentAttempts=[]),this.state.recentAttempts.push({isCorrect:n,timeSpent:o,timestamp:s}),n?(this.state.noteHistory[t.name].correct+=1,this.showFeedback(!0,`Correct! That's ${t.name}`)):(this.state.noteHistory[t.name].incorrect+=1,this.showFeedback(!1,`Incorrect. That was ${t.name}, not ${e.name}`)),this.updateStats(),this.storageManager.saveState(this.state),setTimeout((()=>{this.moveToNextNote()}),1500)}moveToNextNote(){this.currentLevel&&(this.state.recentAttempts&&this.currentLevel.isComplete(this.state.recentAttempts)?this.levelUp():(this.currentLevel.nextNote(),this.displayCurrentNote()))}levelUp(){this.state.currentLevelIndex++,this.storageManager.saveState(this.state),this.state.currentLevelIndex<i.levels.length?(this.showFeedback(!0,`Level Up! Moving to level ${this.state.currentLevelIndex+1}`),setTimeout((()=>{this.loadLevel(this.state.currentLevelIndex)}),2e3)):(this.showFeedback(!0,"Congratulations! You've completed all levels!"),this.state.isGameRunning=!1)}showFeedback(e,t){this.feedbackElement.textContent=t,this.feedbackElement.className=e?"correct":"incorrect"}clearFeedback(){this.feedbackElement.textContent="",this.feedbackElement.className=""}calculateCurrentStreak(){if(!this.state.recentAttempts||0===this.state.recentAttempts.length)return 0;let e=0;for(let t=this.state.recentAttempts.length-1;t>=0&&this.state.recentAttempts[t].isCorrect;t--)e++;return e}calculateAverageSpeed(){if(!this.state.recentAttempts||0===this.state.recentAttempts.length)return 0;const e=i.levels[this.state.currentLevelIndex],t=e?.requiredSuccessCount||10,n=this.state.recentAttempts.slice(-t);return n.reduce(((e,t)=>e+t.timeSpent),0)/n.length}updateStats(){const e=this.calculateCurrentStreak();this.streakElement&&(this.streakElement.textContent=e.toString());const t=this.calculateAverageSpeed();this.speedElement&&(this.speedElement.textContent=t.toFixed(1)),this.updateVisualFeedback()}updateLevelRequirements(){if(!this.currentLevel)return;const e=i.levels[this.state.currentLevelIndex],t=e?.requiredSuccessCount||10,n=e?.maxTimePerProblem||5;this.streakRequiredElement&&(this.streakRequiredElement.textContent=t.toString()),this.speedRequiredElement&&(this.speedRequiredElement.textContent=n.toString())}updateVisualFeedback(){if(!this.streakElement||!this.speedElement)return;const e=this.calculateCurrentStreak(),t=this.calculateAverageSpeed(),n=i.levels[this.state.currentLevelIndex],s=n?.requiredSuccessCount||10,o=n?.maxTimePerProblem||5;this.streakElement.className=e>=s?"goal-met":e>=s/2?"progress":"",this.speedElement.className=t>0&&t<o?"goal-met":t>0&&t<1.5*o?"progress":""}clearNoteOptions(){this.noteOptionsContainer.innerHTML=""}}var h=n(72),d=n.n(h),m=n(825),u=n.n(m),p=n(659),f=n.n(p),g=n(56),b=n.n(g),v=n(540),x=n.n(v),S=n(113),y=n.n(S),C=n(552),w={};w.styleTagTransform=y(),w.setAttributes=b(),w.insert=f().bind(null,"head"),w.domAPI=u(),w.insertStyleElement=x(),d()(C.A,w),C.A&&C.A.locals&&C.A.locals,document.addEventListener("DOMContentLoaded",(()=>{const e=new c,t=new l("music-reading-game"),n=document.getElementById("start-button"),s=document.getElementById("reset-button"),o=document.getElementById("clear-storage-button");n.addEventListener("click",(()=>{console.log("Start button clicked"),e.start()})),s.addEventListener("click",(()=>{console.log("Reset button clicked"),e.reset()})),o.addEventListener("click",(()=>{console.log("Clear Storage button clicked"),t.clearState(),alert("Storage cleared! Refresh the page to start with fresh state.")}))}))})();